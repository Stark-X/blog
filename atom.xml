<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Stark-X&#39;s Blog</title>
  
  <subtitle>Beneath this blog there is an idea</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.stark-x.cn/"/>
  <updated>2020-03-06T15:56:16.910Z</updated>
  <id>https://blog.stark-x.cn/</id>
  
  <author>
    <name>Stark-X</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>shell - value too great for base (error token is &quot;08&quot;)</title>
    <link href="https://blog.stark-x.cn/2020/03/06/shell-value-too-great-for-base-error-token-is-08/"/>
    <id>https://blog.stark-x.cn/2020/03/06/shell-value-too-great-for-base-error-token-is-08/</id>
    <published>2020-03-06T15:39:54.000Z</published>
    <updated>2020-03-06T15:56:16.910Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><!-- Description to show on index here  --><p>åœ¨ shell è„šæœ¬ç¼–å†™æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦è¿›è¡Œæ•°å­¦è¿ç®—ï¼ˆä¾‹å­ğŸŒ°ï¼š<code>$((1 + 1))</code>ï¼‰ï¼Œç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¾“å…¥çš„æ•°å­—æ˜¯å¸¦ç€ 0 å‰åºçš„ï¼Œå½“å¯¹è¿™ä¸ªå¸¦ç€ 0 å‰åºçš„æ•°å­—è¿›è¡Œæ•°å­¦è¿ç®—æ—¶ï¼Œè®¡ç®—ç»“æœä¼šä¸é¢„æƒ³ä¸­çš„ä¸ä¸€è‡´ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ï¼Œé”™è¯¯ä¿¡æ¯å¦‚<code>value too great for base (error token is &quot;02&quot;)</code></p><p>é‚£æ˜¯å› ä¸º bash æ‰§è¡Œ shell script æ—¶ï¼Œ0 å‰ç¼€çš„æ•°å­—è¢«è®¤ä¸ºæ˜¯ 8 è¿›åˆ¶çš„æ•°å­—ï¼Œç»è¿‡æµ‹è¯•ï¼Œzsh é‡Œä¸ä¼šæŠ¥é”™ï¼Œæ•°å­—â€œ09â€è¿˜æ˜¯è¢«è®¤ä¸ºæ˜¯åè¿›åˆ¶çš„â€œ9â€ã€‚</p><a id="more"></a><h2 id="ä¾‹å­-ğŸŒ°"><a href="#ä¾‹å­-ğŸŒ°" class="headerlink" title="ä¾‹å­ ğŸŒ°"></a>ä¾‹å­ ğŸŒ°</h2><p>æœ‰å¦‚ä¸‹ crontab å®šæ—¶ä»»åŠ¡ï¼Œåœ¨æ¯éš”ä¸€ä¸ªå‘¨æ—¥çš„å‡Œæ™¨ 3 ç‚¹é’Ÿæ‰§è¡Œè„šæœ¬ /backup/backup.shï¼Œç¼–å†™çš„ crontab å†…å®¹å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># crontab</span></span><br><span class="line">0 3 * * 7 [ $(($(date +%U) % 2)) -eq 0 ] &amp;&amp; sh /bakcup/backup.sh</span><br></pre></td></tr></table></figure><p><code>[ $(($(date +%U) % 2)) -eq 0 ]</code> è¡¨ç¤ºè·å–å½“å‰çš„å‘¨åºå·ï¼ˆä»¥å‘¨æ—¥ä½œä¸ºç¬¬ä¸€å¤©çš„å‘¨ï¼‰ï¼ŒæŠŠç»“æœæ¨¡ 2ï¼Œä½™æ•°æ˜¯å¦ç­‰äº 0ï¼Œä»¥æ­¤åˆ¤å®šæ˜¯å¦ä¸ºå¶æ•°å‘¨ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ‰§è¡Œâ€œ&amp;&amp;â€åé¢çš„å‘½ä»¤ã€‚</p><p>å¦‚æœæŠŠ zsh ä½œä¸º shellï¼Œåœ¨æµ‹è¯•è¿™ä¸€æ¡å‘½ä»¤æ—¶ï¼Œæˆ–è€…åˆšå¥½å½“å‰çš„å‘¨æ˜¯åŒä½æ•°ï¼Œåˆ™ä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿå°±ä¸ä¼šå‘ç°è¿™ä¸ªé—®é¢˜ï¼Œç›´åˆ°æœ€å¤šé•¿è¾¾ 40+ å‘¨ä¹‹åï¼Œæ‰ä¼šåœ¨ç¬¬äºŒå¹´çš„å¼€å¤´å‘ç°å®šæ—¶ä»»åŠ¡æ— æ³•æ­£å¸¸æ‰§è¡Œã€‚</p><h2 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h2><p>åœ¨æ•°å­—å‰é¢åŠ ä¸Š <code>10#</code>ï¼Œæ˜¾å¼åœ°æŠŠè¯¥æ•°å­—æ ‡è®°ä¸ºåè¿›åˆ¶ï¼Œä¸Šè¿°çš„ crontab æ”¹ä¸ºå¦‚ä¸‹ç‰ˆæœ¬å³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 3 * * 7 [ $((10<span class="comment">#$(date +%U) % 2)) -eq 0 ] &amp;&amp; sh /bakcup/backup.sh</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;!-- Description to show on index here  --&gt;
&lt;p&gt;åœ¨ shell è„šæœ¬ç¼–å†™æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦è¿›è¡Œæ•°å­¦è¿ç®—ï¼ˆä¾‹å­ğŸŒ°ï¼š&lt;code&gt;$((1 + 1))&lt;/code&gt;ï¼‰ï¼Œç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¾“å…¥çš„æ•°å­—æ˜¯å¸¦ç€ 0 å‰åºçš„ï¼Œå½“å¯¹è¿™ä¸ªå¸¦ç€ 0 å‰åºçš„æ•°å­—è¿›è¡Œæ•°å­¦è¿ç®—æ—¶ï¼Œè®¡ç®—ç»“æœä¼šä¸é¢„æƒ³ä¸­çš„ä¸ä¸€è‡´ï¼Œæˆ–è€…ç›´æ¥æŠ¥é”™ï¼Œé”™è¯¯ä¿¡æ¯å¦‚&lt;code&gt;value too great for base (error token is &amp;quot;02&amp;quot;)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;é‚£æ˜¯å› ä¸º bash æ‰§è¡Œ shell script æ—¶ï¼Œ0 å‰ç¼€çš„æ•°å­—è¢«è®¤ä¸ºæ˜¯ 8 è¿›åˆ¶çš„æ•°å­—ï¼Œç»è¿‡æµ‹è¯•ï¼Œzsh é‡Œä¸ä¼šæŠ¥é”™ï¼Œæ•°å­—â€œ09â€è¿˜æ˜¯è¢«è®¤ä¸ºæ˜¯åè¿›åˆ¶çš„â€œ9â€ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="troubleshoot" scheme="https://blog.stark-x.cn/categories/troubleshoot/"/>
    
    
      <category term="shell" scheme="https://blog.stark-x.cn/tags/shell/"/>
    
      <category term="ç–‘éš¾æ‚ç—‡" scheme="https://blog.stark-x.cn/tags/%E7%96%91%E9%9A%BE%E6%9D%82%E7%97%87/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Kubeadm, Vagrant, Virtualboxéƒ¨ç½²æœ¬åœ°Kubernetesé›†ç¾¤ - TL;DR</title>
    <link href="https://blog.stark-x.cn/2019/03/04/local-kubernetes-cluster-with-kubeadm-vagrant-and-virtualbox-tldr/"/>
    <id>https://blog.stark-x.cn/2019/03/04/local-kubernetes-cluster-with-kubeadm-vagrant-and-virtualbox-tldr/</id>
    <published>2019-03-04T15:25:14.000Z</published>
    <updated>2019-03-05T16:21:18.620Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><!-- Description to show on index here  --><p>æœ¬æ–‡ç« æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« ã€Œ<a href="/2018/11/14/Local-kubernetes-cluster-with-kubeadm-vagrant-and-virtualbox/" title="ä½¿ç”¨Kubeadm, Vagrant, Virtualboxéƒ¨ç½²æœ¬åœ°Kubernetesé›†ç¾¤">ä½¿ç”¨Kubeadm, Vagrant, Virtualboxéƒ¨ç½²æœ¬åœ°Kubernetesé›†ç¾¤</a>ã€çš„ TL;DR ç‰ˆæœ¬ã€‚</p><h1 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h1><ul><li>å¯åŠ¨ä¸¤ä¸ªè™šæ‹Ÿæœºï¼Œä¸€ä¸ªä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œä¸€ä¸ªä½œä¸ºå·¥ä½œèŠ‚ç‚¹</li><li>ç†Ÿæ‚‰ Kubeadm</li><li>åœ¨é›†ç¾¤ä¸Šéƒ¨ç½²Kubernetes-dashboardã€nginx</li></ul><a id="more"></a><h1 id="ç¯å¢ƒç›¸å…³"><a href="#ç¯å¢ƒç›¸å…³" class="headerlink" title="ç¯å¢ƒç›¸å…³"></a>ç¯å¢ƒç›¸å…³</h1><ul><li>æ“ä½œç³»ç»Ÿï¼šmacOS Mojave 10.14.3 (18D109)</li><li>ç¼–æ’å·¥å…·ï¼šVagrant 2.2.3 </li><li>è™šæ‹Ÿæœºï¼šVirtualbox 6.0</li><li>å¯å˜å‚æ•°ï¼šæ³¨æ„æ‰€æœ‰æ›¿æ¢æ–‡ä¸­æ‰€æœ‰çš„${xxx}ä¸ºè‡ªå·±ç¯å¢ƒçš„å€¼</li></ul><h1 id="å®éªŒç¯å¢ƒè®¾è®¡"><a href="#å®éªŒç¯å¢ƒè®¾è®¡" class="headerlink" title="å®éªŒç¯å¢ƒè®¾è®¡"></a>å®éªŒç¯å¢ƒè®¾è®¡</h1><p>ä½¿ç”¨ Vagrant é…åˆ Virtualbox å»ºç«‹ä¸¤ä¸ªèŠ‚ç‚¹æ¨¡æ‹Ÿé›†ç¾¤ï¼Œä¸€ä¸ªä½œä¸º master nodeï¼Œä¸€ä¸ªä½œä¸º work nodeã€‚</p><h2 id="è¦æ±‚"><a href="#è¦æ±‚" class="headerlink" title="è¦æ±‚"></a>è¦æ±‚</h2><ul><li>master:<ul><li>network:<ul><li>8001:8001/tcp</li><li>80:10000/tcp</li></ul></li></ul></li><li>worker:<ul><li>network:<ul><li>80:10001/tcp</li></ul></li></ul></li><li>master &amp; worker:<ul><li>OS: Ubuntu/xenial64</li><li>CPU: 2 core</li><li>MEM: 2 GB</li><li>network:<ul><li>iface x 2: NAT &amp; Host-Only</li></ul></li><li>dependencies:<ul><li>kubelet</li><li>kubectl</li><li>kubeadm</li><li>docker</li></ul></li></ul></li></ul><h2 id="Vagrantfile"><a href="#Vagrantfile" class="headerlink" title="Vagrantfile"></a>Vagrantfile</h2><figure class="highlight ruby"><figcaption><span>Vagrantfile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">$script = <span class="string">&lt;&lt;-SCRIPT</span></span><br><span class="line"><span class="string">echo "Update and install the kubeadm"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl</span></span><br><span class="line"><span class="string">curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -</span></span><br><span class="line"><span class="string">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span></span><br><span class="line"><span class="string">deb https://apt.kubernetes.io/ kubernetes-xenial main</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get install -y kubelet kubeadm kubectl docker.io</span><br><span class="line">apt-mark hold kubelet kubeadm kubectl</span><br><span class="line">usermod -aG docker vagrant</span><br><span class="line">kubeadm config images pull</span><br><span class="line">SCRIPT</span><br><span class="line"></span><br><span class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> <span class="params">|config|</span></span><br><span class="line">  config.vm.provider <span class="string">"virtualbox"</span> <span class="keyword">do</span> <span class="params">|v|</span></span><br><span class="line">    v.memory = <span class="number">2048</span></span><br><span class="line">    v.cpus = <span class="number">2</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  </span><br><span class="line">  config.vm.define <span class="string">"master"</span>, <span class="symbol">primary:</span> <span class="literal">true</span> <span class="keyword">do</span> <span class="params">|master|</span></span><br><span class="line">    master.vm.hostname = <span class="string">"k8s-cluster-master"</span></span><br><span class="line">    master.vm.box = <span class="string">"ubuntu/xenial64"</span></span><br><span class="line">    master.vm.network <span class="string">"forwarded_port"</span>, <span class="symbol">guest:</span> <span class="number">80</span>, <span class="symbol">host:</span> <span class="number">10000</span>, <span class="symbol">protocol:</span> <span class="string">"tcp"</span></span><br><span class="line">    master.vm.network <span class="string">"forwarded_port"</span>, <span class="symbol">guest:</span> <span class="number">8001</span>, <span class="symbol">host:</span> <span class="number">8001</span>, <span class="symbol">protocol:</span> <span class="string">"tcp"</span></span><br><span class="line">    master.vm.network <span class="string">"private_network"</span>, <span class="symbol">type:</span> <span class="string">"dhcp"</span></span><br><span class="line">    master.vm.provision <span class="string">"shell"</span>, <span class="symbol">inline:</span> $script</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  config.vm.define <span class="string">"node"</span> <span class="keyword">do</span> <span class="params">|node|</span></span><br><span class="line">    node.vm.hostname = <span class="string">"k8s-cluster-node"</span></span><br><span class="line">    node.vm.box = <span class="string">"ubuntu/xenial64"</span></span><br><span class="line">    node.vm.network <span class="string">"forwarded_port"</span>, <span class="symbol">guest:</span> <span class="number">80</span>, <span class="symbol">host:</span> <span class="number">10001</span>, <span class="symbol">protocol:</span> <span class="string">"tcp"</span></span><br><span class="line">    node.vm.network <span class="string">"private_network"</span>, <span class="symbol">type:</span> <span class="string">"dhcp"</span></span><br><span class="line">    node.vm.provision <span class="string">"shell"</span>, <span class="symbol">inline:</span> $script</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨èŠ‚ç‚¹"><a href="#å¯åŠ¨èŠ‚ç‚¹" class="headerlink" title="å¯åŠ¨èŠ‚ç‚¹"></a>å¯åŠ¨èŠ‚ç‚¹</h2><p>æ‰§è¡Œå‘½ä»¤<code>vagrant up</code>ï¼ŒVagrant å¼€å§‹è‡ªåŠ¨ä¸‹è½½Ubuntué•œåƒï¼Œé¡ºåˆ©å¯åŠ¨åï¼Œvagrant ä¼šæ‰§è¡Œæˆ‘ä»¬å†™åœ¨<code>Vagrantfile</code>é‡Œçš„ Shell è„šæœ¬ã€‚åˆå§‹åŒ–å®Œæˆåï¼Œåœ¨å½“å‰çª—å£æ‰§è¡Œ<code>vagrant ssh master</code>ï¼Œæ–°å¼€ä¸€ä¸ªçª—å£æ‰§è¡Œ<code>vagrant ssh node</code>åˆ†åˆ« ssh è¿›å…¥åˆ°ä¸»èŠ‚ç‚¹ä»¥åŠå·¥ä½œèŠ‚ç‚¹ã€‚<br><img src="http://img-cdn.xjztest.com/20190305142616-vagrant_up.png.png" alt="vagrant up"><em><small>ç¬¬ä¸€æ¬¡æ‰§è¡Œ<code>vagrant up</code>ä¼šçœ‹åˆ°æ›´å¤šçš„ä¿¡æ¯ã€‚</small></em></p><p>ä½¿ç”¨å‘½ä»¤<code>ip a</code>æŸ¥çœ‹å½“å‰èŠ‚ç‚¹ ipï¼Œä¸¤ä¸ªèŠ‚ç‚¹äº’ç›¸ pingï¼Œæ£€æŸ¥è¿é€šæ€§ã€‚</p><h1 id="éƒ¨ç½²-Kubernetes-é›†ç¾¤"><a href="#éƒ¨ç½²-Kubernetes-é›†ç¾¤" class="headerlink" title="éƒ¨ç½² Kubernetes é›†ç¾¤"></a>éƒ¨ç½² Kubernetes é›†ç¾¤</h1><p>æ ¹æ®ä¸Šè¿° Vagrantfile åˆ›å»ºå‡ºæ¥çš„è™šæ‹Ÿæœºå„æœ‰ä¸¤ä¸ªç½‘å¡ï¼Œç¬¬ä¸€ä¸ªæ˜¯ NAT æ¨¡å¼ï¼Œç¬¬äºŒä¸ªæ˜¯ Host-Only æ¨¡å¼ï¼Œè€Œ Kubernetes nodes èŠ‚ç‚¹é—´é€šè®¯åº”è¯¥é€šè¿‡ç¬¬äºŒä¸ªç½‘å¡ï¼Œæ‰€ä»¥é€‰æ‹©äº† <em>flannel</em> ä½œä¸º <a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/" target="_blank" rel="noopener">CNI æ’ä»¶</a>ï¼Œå› ä¸ºå®ƒå¯ä»¥æŒ‡å®šç”¨äºèŠ‚ç‚¹é—´é€šè®¯çš„ç½‘å¡ (iface)(<a href="https://github.com/coreos/flannel/blob/master/Documentation/troubleshooting.md#vagrant" target="_blank" rel="noopener">åŸå› </a>)ã€‚</p><p>å‚è€ƒ<a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>è·å– <em>flannel</em> çš„ yaml æ–‡ä»¶ï¼Œä¿®æ”¹ç³»ç»Ÿå‚æ•°ï¼Œå¹¶ä¿®æ”¹ iface ä½¿ç”¨ç¬¬äºŒä¸ªç½‘å¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo sysctl net.bridge.bridge-nf-call-iptables=1</span><br><span class="line">wget https://github.com/coreos/flannel/blob/master/Documentation/kube-flannel.yml</span><br><span class="line"><span class="comment"># æ‰¾åˆ°image tagæ˜¯-amd64ç»“å°¾çš„/opt/bin/flanneldï¼Œåœ¨ä¸‹é¢çš„argsåˆ—è¡¨æ·»åŠ  - --iface ä»¥åŠ - enp0s8 è¿™ä¸¤è¡Œ</span></span><br><span class="line"><span class="comment"># vim kube-flannel.md</span></span><br></pre></td></tr></table></figure></li><li><p>åœ¨ä¸»èŠ‚ç‚¹ <em>k8s-cluster-master</em> æ‰§è¡Œ<code>sudo kubeadm init --apiserver-advertise-address=${ip} --pod-network-cidr=10.244.0.0/16</code>åˆå§‹åŒ–èŠ‚ç‚¹ï¼ŒæˆåŠŸåï¼Œæ ¹æ® kubeadm çš„è¾“å‡ºï¼Œæ‰§è¡Œæ¥ä¸‹æ¥çš„å‘½ä»¤ã€‚</p></li><li><p>å¤åˆ¶ kubeadm ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œæ›´æ”¹é…ç½®æ–‡ä»¶å¤¹çš„æƒé™</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ CNI æ’ä»¶ <em>flannel</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f kube-flannel.yml</span><br></pre></td></tr></table></figure></li><li><p>æŠŠä¸‹é¢ shell è„šæœ¬ä¿å­˜ä¸º â€œchange-kubelet-node-ip.shâ€ï¼Œå¹¶æ‰§è¡Œ</p><figure class="highlight bash"><figcaption><span>change-kubelet-node-ip.sh</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">COND_NODE_IP=`grep node-ip /var/lib/kubelet/kubeadm-flags.env | wc -l`</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;COND_NODE_IP&#125;</span> = 1 ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"--node-ip had been set, skipped"</span></span><br><span class="line">  <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">sudo sed -i <span class="string">'/^.*/ s/$/ --node-ip=$&#123;ip&#125;/'</span> /var/lib/kubelet/kubeadm-flags.env</span><br><span class="line">sudo systemctl restart kubelet</span><br></pre></td></tr></table></figure></li><li><p>åœ¨ workerèŠ‚ç‚¹æ‰§è¡Œå¦‚ä¸‹è„šæœ¬ï¼ŒæŠŠ worker èŠ‚ç‚¹åŠ å…¥åˆ° Kubernetes é›†ç¾¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join <span class="variable">$&#123;master_ip&#125;</span>:6443 --token <span class="variable">$&#123;token&#125;</span> --discovery-token-ca-cert-hash sha256:<span class="variable">$&#123;hash&#125;</span> --apiserver-advertise-address=<span class="variable">$&#123;worker_ip&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>åœ¨ worker èŠ‚ç‚¹åŒæ ·è¿è¡Œä¸Šè¿°çš„ â€œchange-kubelet-node-ip.shâ€ï¼Œæ³¨æ„ä¿®æ”¹è„šæœ¬é‡Œçš„ ipåœ°å€ä¸º worker èŠ‚ç‚¹çš„ ipã€‚</p></li><li>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼ŒPods çŠ¶æ€</li></ol><p><img src="http://img-cdn.xjztest.com/20190305154528-get_pods_nodes-master.png.png" alt="Node: master | get pods, get nodes"><center><small>Node: master | get pods, get nodes</small></center></p><p><img src="http://img-cdn.xjztest.com/20190305154700-kubeadm_join-worker.png.png" alt="Node: worker | kubeadm join"><center><small>Node: worker | kubeadm join</small></center></p><h1 id="éƒ¨ç½²-Kubernetes-Dashboard"><a href="#éƒ¨ç½²-Kubernetes-Dashboard" class="headerlink" title="éƒ¨ç½² Kubernetes Dashboard"></a>éƒ¨ç½² Kubernetes Dashboard</h1><ol><li>ä»<a href="https://github.com/kubernetes/dashboard" target="_blank" rel="noopener">Kubernetes Dashboard Repo</a>è·å–éƒ¨ç½²å‘½ä»¤ï¼Œéƒ¨ç½² dashboardã€‚</li><li>æŸ¥çœ‹ pods çŠ¶æ€ï¼Œç›´åˆ°ç›¸å…³ pods å¤„äº running çŠ¶æ€ã€‚</li><li>å¯åŠ¨ Kubenetes Proxyã€‚ </li><li>é€šè¿‡ proxy è®¿é—® Dashboard: <a href="http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/" target="_blank" rel="noopener">http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/</a> ã€‚(Kubernetes Proxy æ˜¯ä¸€ä¸ªåå‘ä»£ç†ï¼ŒæŠŠå¤–éƒ¨è¯·æ±‚é€šè¿‡ä¸»èŠ‚ç‚¹/é›†ç¾¤ï¼Œè½¬å‘åˆ°å·¥ä½œèŠ‚ç‚¹/é›†ç¾¤ï¼Œé¿å…ç›´æ¥æš´éœ²æœåŠ¡ï¼Œé™ä½å®‰å…¨é£é™©)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml</span><br><span class="line">kubectl get pods -n kube-system</span><br><span class="line">kubectl proxy --address 0.0.0.0</span><br></pre></td></tr></table></figure><p><img src="http://img-cdn.xjztest.com/20190305160256-kubernetes_dashboard-master.png.png" alt="Node: master | Kubernetes dashboard"><center><small>Node: master | Kubernetes dashboard</small></center></p><p><img src="http://img-cdn.xjztest.com/20190305160831-Kubernetes_dashboard-access.png.png" alt="Kubernetes Dashboard Login"> <center><small>Kubernetes Dashboard Login</small></center></p><h1 id="éƒ¨ç½²-Nginx"><a href="#éƒ¨ç½²-Nginx" class="headerlink" title="éƒ¨ç½² Nginx"></a>éƒ¨ç½² Nginx</h1><p>ç¼–å†™ä¸€ä¸ª yaml æ–‡ä»¶ï¼Œéƒ¨ç½²ä¸¤ä¸ª NGINX instance åˆ°é›†ç¾¤ã€‚</p><h2 id="nginx-rs-yaml"><a href="#nginx-rs-yaml" class="headerlink" title="nginx-rs.yaml"></a>nginx-rs.yaml</h2><p>ä¿å­˜ä¸‹é¢çš„yamlï¼Œå‘½åä¸º â€œnginx-rs.yamlâ€ã€‚</p><figure class="highlight yaml"><figcaption><span>nginx-rs.yaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    svc:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">ClusterIP</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - port:</span> <span class="number">9999</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">  revisionHistoryLimit:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      svc:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        svc:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">          image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">          - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">            protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi nginx-rs.yaml</span></span><br><span class="line">kubectl apply -f nginx-rs.yaml</span><br><span class="line">kubectl get pods</span><br><span class="line">kubectl proxy --address 0.0.0.0</span><br></pre></td></tr></table></figure><p>åœ¨å®¿ä¸»æœºæ‰“å¼€ <a href="http://localhost:8001/api/v1/namespaces/default/services/nginx/proxy/" target="_blank" rel="noopener">http://localhost:8001/api/v1/namespaces/default/services/nginx/proxy/</a> å³å¯çœ‹åˆ°ç†Ÿæ‚‰çš„ NGINX é»˜è®¤é¦–é¡µã€‚(<a href="https://kubernetes.io/zh/docs/tasks/access-application-cluster/access-cluster/#%E6%89%8B%E5%8A%A8%E6%9E%84%E5%BB%BA-apiserver-%E4%BB%A3%E7%90%86-url" target="_blank" rel="noopener">Kubernetes proxy URL è§„åˆ™</a>)</p><p><img src="http://img-cdn.xjztest.com/20190305162916-kubernetes_nginx.png.png" alt="Nginx via Kubernetes proxy"> <center><small>Nginx via Kubernetes proxy</small></center></p><h1 id="å®Œ"><a href="#å®Œ" class="headerlink" title="å®Œ"></a>å®Œ</h1><p>æ­¤ç¯‡æ–‡ç« çœç•¥äº†åœ¨å®éªŒæœŸé—´è¸©è¿‡çš„å¤§é‡çš„å‘ï¼Œå¦‚æœè·Ÿç€æˆ‘çš„æµç¨‹ä¸‹æ¥é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜å¯ä»¥å…ˆæŸ¥çœ‹ä¸Šä¸€ç¯‡æ–‡ç« ã€Œ<a href="/2018/11/14/Local-kubernetes-cluster-with-kubeadm-vagrant-and-virtualbox/" title="ä½¿ç”¨Kubeadm, Vagrant, Virtualboxéƒ¨ç½²æœ¬åœ°Kubernetesé›†ç¾¤">ä½¿ç”¨Kubeadm, Vagrant, Virtualboxéƒ¨ç½²æœ¬åœ°Kubernetesé›†ç¾¤</a>ã€ï¼Œå¯èƒ½ä½ ä¼šæ‰¾åˆ°ç­”æ¡ˆï¼Œæˆ–è€…åœ¨ä¸‹æ–¹ç•™è¨€è¯„è®ºã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;!-- Description to show on index here  --&gt;
&lt;p&gt;æœ¬æ–‡ç« æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« ã€Œ&lt;a href=&quot;/2018/11/14/Local-kubernetes-cluster-with-kubeadm-vagrant-and-virtualbox/&quot; title=&quot;ä½¿ç”¨Kubeadm, Vagrant, Virtualboxéƒ¨ç½²æœ¬åœ°Kubernetesé›†ç¾¤&quot;&gt;ä½¿ç”¨Kubeadm, Vagrant, Virtualboxéƒ¨ç½²æœ¬åœ°Kubernetesé›†ç¾¤&lt;/a&gt;ã€çš„ TL;DR ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h1 id=&quot;ç›®æ ‡&quot;&gt;&lt;a href=&quot;#ç›®æ ‡&quot; class=&quot;headerlink&quot; title=&quot;ç›®æ ‡&quot;&gt;&lt;/a&gt;ç›®æ ‡&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;å¯åŠ¨ä¸¤ä¸ªè™šæ‹Ÿæœºï¼Œä¸€ä¸ªä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œä¸€ä¸ªä½œä¸ºå·¥ä½œèŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;ç†Ÿæ‚‰ Kubeadm&lt;/li&gt;
&lt;li&gt;åœ¨é›†ç¾¤ä¸Šéƒ¨ç½²Kubernetes-dashboardã€nginx&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Solutions" scheme="https://blog.stark-x.cn/categories/Solutions/"/>
    
    
      <category term="Ops" scheme="https://blog.stark-x.cn/tags/Ops/"/>
    
      <category term="Kubernetes" scheme="https://blog.stark-x.cn/tags/Kubernetes/"/>
    
      <category term="Vagrant" scheme="https://blog.stark-x.cn/tags/Vagrant/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨Kubeadm, Vagrant, Virtualboxéƒ¨ç½²æœ¬åœ°Kubernetesé›†ç¾¤</title>
    <link href="https://blog.stark-x.cn/2018/11/14/Local-kubernetes-cluster-with-kubeadm-vagrant-and-virtualbox/"/>
    <id>https://blog.stark-x.cn/2018/11/14/Local-kubernetes-cluster-with-kubeadm-vagrant-and-virtualbox/</id>
    <published>2018-11-14T12:09:31.000Z</published>
    <updated>2019-03-05T08:46:21.213Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><!-- Description to show on index here  --><p>åœ¨å‰ä¸€é˜µå­å‚åŠ äº†DevOpså›½é™…å³°ä¼š(DevOps International Summit)ï¼Œã€ŠDevOps Handbookã€‹å’Œã€ŠBeyond The Phoenix Projectã€‹çš„è”åˆä½œè€… John Willis åœ¨ä»–çš„åˆ†äº«ä¸­æå‡ºäº†â€œKuberneteså°†æˆä¸ºæœªæ¥çš„ä¸»æµâ€ï¼Œå†åŠ ä¸Šæˆ‘æ‰€åœ¨å…¬å¸æœ‰å¤§é‡çš„å¾®æœåŠ¡æ¶æ„é¡¹ç›®ä½¿ç”¨åˆ°äº†Kubernetesï¼Œé‚å¼€å§‹å­¦ä¹ Kubernetesã€‚<br>é‚£è¦å»å­¦ä¹ å®ƒå°±å¿…é¡»å¾—æœ‰å¯æ“ä½œç¯å¢ƒï¼Œåœ¨<a href="https://kubernetes.io/docs/setup/pick-right-solution/#local-machine-solutions" target="_blank" rel="noopener">Kuberneteså®˜ç½‘</a>æä¾›äº†å¥½å¤šä¸ªè§£å†³æ–¹æ¡ˆã€‚</p><p>æˆ‘é€‰æ‹©äº†éš¾åº¦ç¨é«˜çš„ kubeadm é…åˆç”± Vagrant ä»¥åŠ Virtualbox æ­å»ºçš„è™šæ‹Ÿæœºåˆ›å»º Kubernetes çš„é›†ç¾¤ï¼Œé€šè¿‡ä½¿ç”¨ kubeadm ç†Ÿæ‚‰ Kubernetes çš„éƒ¨ç½²æµç¨‹ä»¥åŠå®ƒçš„åŸç†ã€‚</p><h1 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h1><ul><li>å¯åŠ¨ä¸¤ä¸ªè™šæ‹Ÿæœºï¼Œä¸€ä¸ªä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œä¸€ä¸ªä½œä¸ºå·¥ä½œèŠ‚ç‚¹</li><li>ç†Ÿæ‚‰ Kubeadm</li><li>åœ¨é›†ç¾¤ä¸Šéƒ¨ç½²Kubernetes-dashboardã€nginx<a id="more"></a></li></ul><h1 id="å¼€å·¥"><a href="#å¼€å·¥" class="headerlink" title="å¼€å·¥"></a>å¼€å·¥</h1><p>æˆ‘ä½¿ç”¨MacOSä½œä¸ºè¿è¡Œç¯å¢ƒå†™çš„è¿™ç¯‡æ–‡ç« ï¼Œåœ¨å…¶å®ƒæ“ä½œç³»ç»Ÿä¸Šè¿›è¡Œæ“ä½œå¯èƒ½ä¼šæœ‰ä¸€ç‚¹ä¸ä¸€æ ·ã€‚å¦å¤–ï¼Œå› ä¸º Kubernetes çš„é•œåƒåœ¨è°·æ­Œçš„æœåŠ¡å™¨ï¼Œæ€»æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œè¯·å…ˆæ¶å¥½æ¢¯å­ï¼Œå¦åˆ™ä¼šå‡ºç°ä¸‹è½½ä¸äº†é•œåƒç­‰â€œæ­£å¸¸â€ç°è±¡ã€‚<br><em><small>æ¢¯å­æ–¹é¢ä¼˜å…ˆé€‰æ‹©ä»˜è´¹æœåŠ¡ï¼Œå¯ä»¥å‡å°‘ä½ å¤§é‡çš„å·¥ä½œã€‚</small></em></p><h2 id="ç¼–å†™-Vagrantfile"><a href="#ç¼–å†™-Vagrantfile" class="headerlink" title="ç¼–å†™ Vagrantfile"></a>ç¼–å†™ Vagrantfile</h2><p>è¦åœ¨æœ¬åœ°å»ºç«‹é›†ç¾¤ï¼Œé‚£å°±å…ˆå»ºä¸¤ä¸ªè™šæ‹Ÿæœºå§ï¼Œè¿™ä¸¤ä¸ªè™šæ‹Ÿæœºé…ç½®ã€è®¾å®šä¸Šåº”è¯¥æ˜¯åŸºæœ¬ä¸€è‡´çš„ï¼Œé‚£å°±ä½¿ç”¨ Vagrant åšåˆå§‹åŒ–ï¼Œç¯å¢ƒé…ç½®ã€‚ä½¿ç”¨ Vagrant çš„ä¸€å¤§å¥½å¤„æ˜¯åªéœ€è¦ä¸€ä»½<code>Vagrantfile</code>å°±å¯ä»¥ä¿è¯ä½¿ç”¨å®ƒå»ºç«‹èµ·æ¥çš„è™šæ‹Ÿæœºæ˜¯ä¸€è‡´çš„ï¼Œå¹¶ä¸”è‡ªåŠ¨åœ°æŠŠä¸‹è½½é•œåƒã€åˆå§‹åŒ–ã€é…ç½®ç­‰ç­‰å…¨åšå¥½äº†ã€‚</p><p>æ—¢ç„¶æ˜¯ä¸ªé›†ç¾¤ï¼Œé‚£å®ƒä»¬ä¹‹é—´åº”è¯¥å¯ä»¥ç›¸äº’é€šè®¯ï¼Œéœ€è¦é…ç½®ä¸€ä¸ªç§æœ‰ç½‘ç»œï¼›å¦å¤–ï¼ŒVagrant é»˜è®¤åˆ›å»ºçš„ç½‘ç»œæ˜¯ NAT æ¨¡å¼ï¼Œé‚£è¦æœ‰ç«¯å£æ˜ å°„ï¼Œé¢„ç•™ç«¯å£ 10000-&gt;80(master)ï¼Œ10001-&gt;80(node)ï¼›æ ¹æ®<a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#before-you-begin" target="_blank" rel="noopener">å®˜ç½‘çš„ä»‹ç»</a>ï¼Œæ‰€æœ‰èŠ‚ç‚¹æ¨èä½¿ç”¨è‡³å°‘2æ ¸CPUï¼Œ2Gå†…å­˜ï¼›åŒæ ·æ ¹æ®<a href="https://kubernetes.io/docs/setup/independent/install-kubeadm/#installing-kubeadm-kubelet-and-kubectl" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œéœ€è¦å®‰è£… kubeletï¼Œkubectlï¼Œkubeadmï¼Œdockerã€‚æ ¹æ®è¿™äº›æ¡ä»¶ï¼Œå°±æœ‰äº†ä¸‹é¢çš„<code>Vagrantfile</code>ã€‚</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$script = <span class="string">&lt;&lt;-SCRIPT</span></span><br><span class="line"><span class="string">echo "Update and install the kubeadm"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl</span></span><br><span class="line"><span class="string">curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -</span></span><br><span class="line"><span class="string">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span></span><br><span class="line"><span class="string">deb https://apt.kubernetes.io/ kubernetes-xenial main</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get install -y kubelet kubeadm kubectl docker.io</span><br><span class="line">apt-mark hold kubelet kubeadm kubectl</span><br><span class="line">usermod -aG docker vagrant</span><br><span class="line">kubeadm config images pull</span><br><span class="line">SCRIPT</span><br><span class="line"></span><br><span class="line">Vagrant.configure(<span class="string">"2"</span>) <span class="keyword">do</span> <span class="params">|config|</span></span><br><span class="line">  config.vm.provider <span class="string">"virtualbox"</span> <span class="keyword">do</span> <span class="params">|v|</span></span><br><span class="line">    v.memory = <span class="number">2048</span></span><br><span class="line">    v.cpus = <span class="number">2</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  </span><br><span class="line">  config.vm.define <span class="string">"master"</span>, <span class="symbol">primary:</span> <span class="literal">true</span> <span class="keyword">do</span> <span class="params">|master|</span></span><br><span class="line">    master.vm.hostname = <span class="string">"k8s-cluster-master"</span></span><br><span class="line">    master.vm.box = <span class="string">"ubuntu/xenial64"</span></span><br><span class="line">    master.vm.network <span class="string">"forwarded_port"</span>, <span class="symbol">guest:</span> <span class="number">80</span>, <span class="symbol">host:</span> <span class="number">10000</span>, <span class="symbol">protocol:</span> <span class="string">"tcp"</span></span><br><span class="line">    master.vm.network <span class="string">"private_network"</span>, <span class="symbol">type:</span> <span class="string">"dhcp"</span></span><br><span class="line">    master.vm.provision <span class="string">"shell"</span>, <span class="symbol">inline:</span> $script</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  config.vm.define <span class="string">"node"</span> <span class="keyword">do</span> <span class="params">|node|</span></span><br><span class="line">    node.vm.hostname = <span class="string">"k8s-cluster-node"</span></span><br><span class="line">    node.vm.box = <span class="string">"ubuntu/xenial64"</span></span><br><span class="line">    node.vm.network <span class="string">"forwarded_port"</span>, <span class="symbol">guest:</span> <span class="number">80</span>, <span class="symbol">host:</span> <span class="number">10001</span>, <span class="symbol">protocol:</span> <span class="string">"tcp"</span></span><br><span class="line">    node.vm.network <span class="string">"private_network"</span>, <span class="symbol">type:</span> <span class="string">"dhcp"</span></span><br><span class="line">    node.vm.provision <span class="string">"shell"</span>, <span class="symbol">inline:</span> $script</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨èŠ‚ç‚¹"><a href="#å¯åŠ¨èŠ‚ç‚¹" class="headerlink" title="å¯åŠ¨èŠ‚ç‚¹"></a>å¯åŠ¨èŠ‚ç‚¹</h2><p>æ‰§è¡Œå‘½ä»¤<code>vagrant up</code>ï¼ŒVagrant å¼€å§‹è‡ªåŠ¨ä¸‹è½½Ubuntué•œåƒï¼Œå¹¶æ‰§è¡Œæˆ‘ä»¬å†™åœ¨<code>Vagrantfile</code>é‡Œçš„ Shell è„šæœ¬ï¼Œé¡ºåˆ©å¯åŠ¨åï¼Œåœ¨å½“å‰çª—å£æ‰§è¡Œ<code>vagrant ssh master</code>ï¼Œæ–°å¼€ä¸€ä¸ªçª—å£æ‰§è¡Œ<code>vagrant ssh node</code>åˆ†åˆ« ssh è¿›å…¥åˆ°ä¸»èŠ‚ç‚¹ä»¥åŠå·¥ä½œèŠ‚ç‚¹ã€‚ <img src="https://i.loli.net/2018/11/14/5bec3c9cd27ad.png" alt="vagrant"><em><small>ç¬¬ä¸€æ¬¡æ‰§è¡Œ<code>vagrant up</code>ä¼šçœ‹åˆ°æ›´å¤šçš„ä¿¡æ¯ã€‚</small></em></p><p>ä½¿ç”¨å‘½ä»¤<code>ip a</code>æŸ¥çœ‹å½“å‰èŠ‚ç‚¹ ipï¼Œä¸¤ä¸ªèŠ‚ç‚¹äº’ç›¸ pingï¼Œæ£€æŸ¥è¿é€šæ€§ã€‚</p><h1 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h1><p>è¿‡ç¨‹æ²¡æœ‰æƒ³è±¡ä¸­é¡ºåˆ©ï¼Œæˆ‘å®Œå…¨è·Ÿç€å®˜ç½‘æ–‡æ¡£æ“ä½œï¼Œå´é™·è¿›åˆ°ä¸€è¿ä¸²çš„å‘é‡Œï¼Œè€—è´¹äº†æ¥è¿‘ä¸¤å‘¨çš„æ—¶é—´æ‰æŠŠ Kubernets é›†ç¾¤æ­å»ºèµ·æ¥ã€‚</p><h2 id="Round-1-Kubernetes-é›†ç¾¤"><a href="#Round-1-Kubernetes-é›†ç¾¤" class="headerlink" title="Round 1 - Kubernetes é›†ç¾¤"></a>Round 1 - Kubernetes é›†ç¾¤</h2><p>æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æŒ‰ç…§<a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>ï¼Œåœ¨ä¸»èŠ‚ç‚¹ <em>k8s-cluster-master</em> æ‰§è¡Œ<code>sudo kubeadm init</code>åˆå§‹åŒ–èŠ‚ç‚¹ï¼ŒæˆåŠŸåï¼Œæ ¹æ® kubeadm çš„è¾“å‡ºï¼Œæ‰§è¡Œæ¥ä¸‹æ¥çš„å‘½ä»¤ã€‚</p><ul><li><p>å¤åˆ¶ kubeadm ç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œæ›´æ”¹é…ç½®æ–‡ä»¶å¤¹çš„æƒé™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure></li><li><p>é€‰æ‹©ä¸€ä¸ª<a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/" target="_blank" rel="noopener">CNI æ’ä»¶</a>ç»„å»ºç½‘ç»œï¼Œæˆ‘ä»¬è¿™é‡Œé€‰æ‹©äº†<em>Weave Net</em></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f &quot;https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d &apos;\n&apos;)&quot;</span><br></pre></td></tr></table></figure></li><li><p>å·¥ä½œèŠ‚ç‚¹æ‰§è¡Œæœ€åä¸€å¥<code>sudo kubeadm join</code>ï¼ŒåŠ å…¥åˆ° Kubernetes é›†ç¾¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 10.0.2.15:6443 --token &lt;token&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼ŒPods çŠ¶æ€</p></li></ul><p><img src="https://i.loli.net/2018/11/22/5bf656dc473c4.png" alt="Node: master | get pods, get nodes"><center><small>Node: master | get pods, get nodes</small></center></p><p><img src="https://i.loli.net/2018/11/22/5bf65a6319aba.png" alt="Node: worker | kubeadm join"><center><small>Node: worker | kubeadm join</small></center></p><h3 id="Round-1-1-å·¥ä½œèŠ‚ç‚¹æ— æ³•è¿æ¥åˆ°ä¸»èŠ‚ç‚¹"><a href="#Round-1-1-å·¥ä½œèŠ‚ç‚¹æ— æ³•è¿æ¥åˆ°ä¸»èŠ‚ç‚¹" class="headerlink" title="Round 1.1 - å·¥ä½œèŠ‚ç‚¹æ— æ³•è¿æ¥åˆ°ä¸»èŠ‚ç‚¹"></a>Round 1.1 - å·¥ä½œèŠ‚ç‚¹æ— æ³•è¿æ¥åˆ°ä¸»èŠ‚ç‚¹</h3><p>è¿™é‡Œé‡åˆ°ç¬¬ä¸€ä¸ªå‘ï¼Œå·¥ä½œèŠ‚ç‚¹æ— æ³•è¿æ¥åˆ°ä¸»èŠ‚ç‚¹çš„ Kubernetes apiã€‚åœ¨å·¥ä½œèŠ‚ç‚¹çš„ <code>kubeadm join</code> logï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° kubelet åœ¨ä¸æ–­åœ°å°è¯•è®¿é—® 10.0.2.15:6443ï¼Œæ›¾ç»çœ‹è¿‡ VirtualBox çš„è¯´æ˜æ–‡æ¡£ï¼Œé»˜è®¤æƒ…å†µä¸‹ ip 10.0.2.15 æ˜¯åœ¨è™šæ‹Ÿæœºåœ¨å®¿ä¸»æœºç½‘ç»œé‡Œçš„ ipï¼Œæ‰€æœ‰çš„è™šæ‹Ÿæœºéƒ½éµå¾ªè¿™ä¸€è®¾å®šï¼Œè€Œå·¥ä½œèŠ‚ç‚¹éœ€è¦è®¿é—®çš„æ˜¯ä¸»èŠ‚ç‚¹çš„ 6443 ç«¯å£ï¼Œç°åœ¨å´åœ¨å°è¯• 10.0.2.15ï¼Œç›¸å½“äºä¸æ–­å°è¯•è¿æ¥èŠ‚ç‚¹è‡ªèº«çš„6443ç«¯å£ï¼Œè¿™æ˜æ˜¾ä¸å¯¹ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ kubelet è®¿é—®/æä¾›æ­£ç¡®çš„èŠ‚ç‚¹ipï¼ŒæŸ¥é˜…æ–‡æ¡£ï¼Œå‘ç° kubeadm æœ‰ä¸€ä¸ªå‚æ•° <code>--apiserver-advertise-address=&lt;ip&gt;</code>ï¼Œæ˜¾å¼æŒ‡å®š kubelet api server çš„ ip åœ°å€ã€‚</p><p>å¥½å§ï¼Œæ‰§è¡Œ<code>sudo kubeadm reset</code>ï¼ŒåŠ ä¸Šå‚æ•°ï¼Œé‡æ–°åšä¸€éã€‚</p><h3 id="Round-1-2-å·¥ä½œèŠ‚ç‚¹-Not-Ready"><a href="#Round-1-2-å·¥ä½œèŠ‚ç‚¹-Not-Ready" class="headerlink" title="Round 1.2 - å·¥ä½œèŠ‚ç‚¹ Not Ready"></a>Round 1.2 - å·¥ä½œèŠ‚ç‚¹ Not Ready</h3><p><img src="https://i.loli.net/2018/11/22/5bf65dc1ca316.png" alt="Node: master | kubeadm init"><center><small>Node: master | kubeadm init</small></center><br><img src="https://i.loli.net/2018/11/22/5bf65d63a35f8.png" alt="Node: worker | kubeadm join"><center><small>Node: worker | kubeadm join</small></center></p><p>æ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯å½“æˆ‘ä»¬åœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œ<code>kubectl get nodes</code>, <code>kubectl get pods -n kube-system</code>ï¼Œå¯ä»¥çœ‹åˆ° node: NotReadyï¼Œweave çš„ Pods ä¸€ç›´å¤„äº CrashLoopBackOff çŠ¶æ€(è¿™è¡¨ç¤º Pod åˆ›å»ºå¤±è´¥ï¼Œkubelet åœ¨ä¸æ–­åœ°é‡è¯•)ï¼Œåœ¨å·¥ä½œèŠ‚ç‚¹æŸ¥çœ‹ docker logs å‘ç° weave ä¸€ç›´åœ¨å°è¯•è¿æ¥ 10.96.0.1:443ï¼Œä½†æ˜¯æ ¹æ® docker logs æ˜¾ç¤ºï¼Œä»¥åŠé€šè¿‡ pingï¼Œtelnet æ£€æµ‹ï¼Œå…¨ timeoutï¼Œç›®æ ‡ä¸å¯è¾¾ã€‚<br><img src="https://i.loli.net/2018/11/22/5bf661e18052d.png" alt="Node: master | get nodes, get pods"><center><small>Node: master | get nodes, get pods</small></center></p><p><img src="https://i.loli.net/2018/11/22/5bf6691bcb58c.png" alt="Node: worker | logs"><center><small>Node: worker | logs</small></center></p><p>è¿™ä¸ª ip åœ°å€ç†åº”æ˜¯ Kubernetes æä¾›çš„ï¼Œç»è¿‡ä¸€ç•ªæŸ¥æ‰¾ï¼Œåœ¨ Services é‡Œæ‰¾åˆ°äº†è¿™ä¸ª ipï¼Œ<code>kubectl get svc</code>ï¼Œå¯ä»¥çœ‹åˆ°è¿”å›ç»“æœè¡¨æ˜ 10.96.0.1 æ˜¯ Kubernetes æœ¬èº«åœ¨é›†ç¾¤é‡Œçš„ ipã€‚</p><p>ä¸ç§‘å­¦å•Šï¼ŒèŠ‚ç‚¹ä¹‹é—´æ˜¯é€šçš„ï¼Œéš¾é“æ˜¯ CNI æ’ä»¶æœ‰é—®é¢˜ï¼Ÿæ¢ä¸€ä¸ªè¯•è¯•ï¼Œåœ¨å®˜ç½‘çš„æ•™ç¨‹é‡Œæœ‰å¥½å‡ ä¸ªå…¶å®ƒæ’ä»¶ä¾›é€‰æ‹©ï¼Œè¿™æ¬¡æˆ‘é€‰æ‹©äº† <em>flannel</em>ï¼Œè·Ÿ <em>Weave Net</em> ä¸å¤ªä¸€æ ·çš„æ˜¯ï¼Œå®ƒéœ€è¦åœ¨ init çš„æ—¶å€™åŠ ä¸Šä¸€ä¸ªé¢å¤–çš„å‚æ•°<code>--pod-network-cidr=10.244.0.0/16</code>ï¼Œnet.bridge.bridge-nf-call-iptables å¿…é¡»è®¾ä¸º 1ï¼Œreset é›†ç¾¤ï¼Œé‡æ–°æ‰§è¡Œå‘½ä»¤éƒ¨ç½²ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sysctl net.bridge.bridge-nf-call-iptables=1</span><br><span class="line">sudo kubeadm init --apiserver-advertise-address 172.28.128.3 --pod-network-cidr=10.244.0.0/16</span><br><span class="line">kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/bc79dd1505b0c8681ece4de4c0d86c5cd2643275/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo kubeadm join 172.28.128.3:6443 --token 4puk29.w2ur96jtfuu9z22v --discovery-token-ca-cert-hash sha256:3973ee67977702c144f6f57613f8ce7765eac975990520846a15465fac625043 --apiserver-advertise-address 172.28.128.4</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2018/11/22/5bf673fe2a2b2.png" alt="Node: master | get nodes, get pods"><center><small>Node: master | get nodes, get pods</small></center><br>è¿™æ¬¡ä¸€åˆ‡éƒ½å¾ˆé¡ºåˆ©ï¼Œ<code>kubectl get nodes</code>æ˜¾ç¤ºèŠ‚ç‚¹ readyï¼Œ<code>kubectl get pods -n kube-system</code>æ˜¾ç¤ºæ‰€æœ‰ Pods è¿è¡Œæ­£å¸¸ï¼Œgreat! </p><h2 id="Round-2-Kubernetes-Dashboard"><a href="#Round-2-Kubernetes-Dashboard" class="headerlink" title="Round 2 - Kubernetes Dashboard"></a>Round 2 - Kubernetes Dashboard</h2><p>ä»<a href="https://github.com/kubernetes/dashboard" target="_blank" rel="noopener">Kubernetes Dashboard Repo</a>è·å–éƒ¨ç½²å‘½ä»¤ï¼Œå¯åŠ¨ Kubenetes Proxyï¼Œé€šè¿‡å®ƒè®¿é—® Dashboard: <a href="http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/" target="_blank" rel="noopener">http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/</a> ã€‚æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯è™šæ‹Ÿæœºçš„ localhostï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æ”¹ VirtualBox çš„ç½‘ç»œé…ç½®ï¼Œæ·»åŠ ä¸€ä¸ªç«¯å£æ˜ å°„åˆ°ä¸»èŠ‚ç‚¹çš„ 8001 ç«¯å£ã€‚(Kubernetes Proxy å°±æ˜¯ä¸€ä¸ªåå‘ä»£ç†ï¼ŒæŠŠå¤–éƒ¨è¯·æ±‚é€šè¿‡ä¸»èŠ‚ç‚¹/é›†ç¾¤ï¼Œè½¬å‘åˆ°å·¥ä½œèŠ‚ç‚¹/é›†ç¾¤ï¼Œé¿å…ç›´æ¥æš´éœ²æœåŠ¡ï¼Œé™ä½å®‰å…¨é£é™©)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/master/src/deploy/recommended/kubernetes-dashboard.yaml</span><br><span class="line">kubectl proxy --address 0.0.0.0 <span class="comment"># å…è®¸è™šæ‹Ÿæœºä¹‹å¤–çš„æµé‡</span></span><br></pre></td></tr></table></figure></p><p><img src="https://i.loli.net/2018/11/23/5bf768a92f3f2.png" alt="Virtualbox | NAT port mapping"> <center><small>Virtualbox | NAT port mapping</small></center><br>ä½†äº‹ä¸æ„¿è¿ï¼Œåˆå‡ºé—®é¢˜äº†ï¼Œä»å®¿ä¸»æœºç”¨æµè§ˆå™¨æ‰“å¼€ä¸Šè¿°ç½‘å€è®¿é—® Dashboardï¼Œè¿”å›å¦‚ä¸‹ jsonã€‚<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"kind"</span>: <span class="string">"Status"</span>,</span><br><span class="line">  <span class="attr">"apiVersion"</span>: <span class="string">"v1"</span>,</span><br><span class="line">  <span class="attr">"metadata"</span>: &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"status"</span>: <span class="string">"Failure"</span>,</span><br><span class="line">  <span class="attr">"message"</span>: <span class="string">"no endpoints available for service \"https:kubernetes-dashboard:\""</span>,</span><br><span class="line">  <span class="attr">"reason"</span>: <span class="string">"ServiceUnavailable"</span>,</span><br><span class="line">  <span class="attr">"code"</span>: <span class="number">503</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="Round-2-1-503"><a href="#Round-2-1-503" class="headerlink" title="Round 2.1 - 503"></a>Round 2.1 - 503</h3><p>æ‰§è¡Œå‘½ä»¤<code>kubectl get pods -n kube-system</code>ï¼Œå‘ç° dashboard è·Ÿä¹‹å‰ Weave Net ä¸€æ ·ï¼Œæ— æ³•æ­£å¸¸åˆ›å»º containerï¼Œåœ¨å·¥ä½œèŠ‚ç‚¹æ‰§è¡Œ<code>docker logs &lt;contianer_name|container_id&gt;</code>æŸ¥çœ‹CNIæ’ä»¶çš„æ—¥å¿—ï¼Œå‘ç°å®ƒè¿˜æ˜¯ä½¿ç”¨äº† NAT ç½‘å¡çš„ ip 10.0.2.15ï¼Œä¹Ÿå°±æ˜¯è™šæ‹Ÿæœºåœ¨è‡ªå·±çš„éš”ç¦»ç½‘ç»œçš„ ipï¼Œæ— æ³•æˆåŠŸç»„ç½‘ï¼Œåœ¨ä¹‹å‰ â€œget nodesâ€ â€œget podsâ€ æ˜¾ç¤ºä¸€åˆ‡æ­£å¸¸ï¼Œåªæ˜¯ <em>flannel</em> è·Ÿ <em>Weave Net</em> å®ç°æ–¹å¼ä¸ä¸€æ ·è€Œå·²ã€‚<br><img src="https://i.loli.net/2018/11/26/5bfba5999e281.png" alt="Node: worker | docker logs"><center><small>Node: worker | docker logs</small></center></p><p>å¤§è‡´åŸå› æ¸…æ¥šäº†ï¼Œé‚£æ€ä¹ˆè§£å†³å‘¢ï¼Ÿâ€get nodesâ€ ä¼šä¸ä¼šæœ‰ç›¸å…³ä¿¡æ¯å‘¢ï¼Ÿæ¥ç€ï¼Œæˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªå‚æ•°çœ‹åˆ°äº†å„ä¸ªèŠ‚ç‚¹çš„ ipï¼Œ<code>kubectl get nodes -o wide</code>ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„èŠ‚ç‚¹çš„ internal ip éƒ½æ˜¯ 10.0.2.15ã€‚åœ¨åˆšå¼€å§‹ï¼Œæˆ‘ä¸ç¡®å®šè¿™ä¸ª â€œinternal ipâ€ åœ¨ Kubernetes é‡Œæœ‰ä»€ä¹ˆå«ä¹‰ï¼Œçæ‰¾äº†ä¸€æ®µæ—¶é—´ï¼Œç”šè‡³ä¿®æ”¹ dashboard çš„ yaml æ–‡ä»¶ï¼Œè®©å®ƒå¼ºåˆ¶è¿è¡Œåœ¨ä¸»èŠ‚ç‚¹ï¼Œä½†åœ¨åé¢éƒ¨ç½²å…¶å®ƒ APP çš„æ—¶å€™éƒ½å‡ºç°äº†é”™è¯¯ï¼Œæ— æ³•è¢«æ­£å¸¸è®¿é—®ï¼Œåªå¥½ç»§ç»­å¯»æ‰¾å…¶å®ƒè§£å†³åŠæ³•ï¼Œæœ€ç»ˆè®©æˆ‘åœ¨å®˜æ–¹æ–‡æ¡£æ‰¾åˆ°äº†æ›´æ”¹å®ƒçš„æ–¹æ³•ã€‚<br>è¿™ä¸ª internal ip å®šä¹‰åœ¨ kubelet çš„å¯åŠ¨å‚æ•°ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿç¬¬ä¸€ä¸ªç½‘å¡çš„ ipï¼Œåœ¨ kubelet çš„å¯åŠ¨å‚æ•°é‡Œï¼Œå®ƒå« â€œnode-ipâ€ã€‚æœ‰ä¸¤ç§æ–¹æ³•ï¼Œ</p><ol><li>é€šè¿‡ kubeadm æ§åˆ¶ kubelet å¯åŠ¨å‚æ•°</li><li>ç›´æ¥æ›´æ”¹ kubelet çš„å¯åŠ¨å‚æ•°</li></ol><p>é¦–å…ˆå°è¯•ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œç„¶åå‘ç° kubeadm ä¸å¯ä»¥é€šè¿‡å‘½ä»¤å‚æ•°æ›´æ”¹ kubelet çš„å¯åŠ¨å‚æ•°ï¼Œåªèƒ½é€šè¿‡æä¾›ä¸€ä¸ªåŒ…å«å¯åŠ¨å‚æ•°çš„é…ç½®æ–‡ä»¶ç»™ kubeadmã€‚å…³äºè¿™ä¸€éƒ¨åˆ†çš„ä¿¡æ¯ï¼Œåœ¨ç½‘ä¸Šåªæœ‰è¾ƒå°‘å¯ä»¥å‚è€ƒï¼Œé€šè¿‡æœç´¢å¼•æ“æ‰¾åˆ°äº† GitHub ä¸Šæœ‰ issue æåˆ°äº†é€šè¿‡åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ï¼Œè€Œä¸”æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰ kubeadm init, kubeadm join çš„å…¶å®ƒæ‰€æœ‰å‚æ•°éƒ½å®šä¹‰åœ¨ kubeadm çš„é…ç½®æ–‡ä»¶é‡Œï¼Œè€Œ node ip çš„æ›´æ”¹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦é€šè¿‡å‚æ•° â€œkubeletExtraArgsâ€ è®¾ç½®é¢å¤–çš„å‚æ•°ä¸ª kubelet å°±å¯ä»¥äº†ã€‚</p><p>ä½†æœ‰ä¸€éƒ¨åˆ†å‚æ•°ï¼Œä¾‹å¦‚å…³äº â€œapiserver-advertise-addressâ€ çš„è®¾å®šå§‹ç»ˆä¸ç”Ÿæ•ˆï¼Œæœ€åå‡­å€Ÿ GitHub ä¸Šçš„å…³é”®å­—åœ¨ kubeadm çš„æ–‡æ¡£é‡Œæ‰¾åˆ°äº†ç›¸å…³æè¿°ï¼ŒåŸæ¥å®ƒä½¿ç”¨çš„é…ç½®æ–‡ä»¶çš„æ–¹æ³•è¿˜æ˜¯å¤„äº alpha é˜¶æ®µï¼Œè€Œä¸” kubeadm join éœ€è¦ç”¨åˆ°çš„ token æ˜¯ç”Ÿæˆçš„ï¼Œæ²¡åŠæ³•å†™æ­»åœ¨é…ç½®æ–‡ä»¶ï¼Œå†ä¸‰è€ƒè™‘ï¼Œè¿˜æ˜¯æ”¾å¼ƒäº†è¿™ç§åŠæ³•ï¼Œè¿˜æ˜¯ä½¿ç”¨åŸæ¥çš„åŠæ³•ï¼Œå†é…åˆä¸€ä¸ªè„šæœ¬ï¼Œæ›´æ”¹ node ipï¼Œè„šæœ¬å†…å®¹å¦‚ä¸‹ï¼Œæ‰§è¡Œå®Œåï¼Œé‡å¯ kubeletï¼Œdocker ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kubeadm.k8s.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">InitConfiguration</span></span><br><span class="line"><span class="attr">apiEndpoint:</span></span><br><span class="line"><span class="attr">  advertiseAddress:</span> <span class="number">172.28</span><span class="number">.128</span><span class="number">.3</span></span><br><span class="line"><span class="attr">nodeRegistration:</span></span><br><span class="line"><span class="attr">  kubeletExtraArgs:</span></span><br><span class="line"><span class="attr">    node-ip:</span> <span class="number">172.28</span><span class="number">.128</span><span class="number">.3</span></span><br><span class="line"><span class="attr">pod-network-cidr:</span> <span class="number">10.244</span><span class="number">.0</span><span class="number">.0</span><span class="string">/1</span></span><br></pre></td></tr></table></figure><center><small>YAML file for kubeadm init</small></center><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/sh</span></span><br><span class="line"></span><br><span class="line">COND_NODE_IP=`sudo grep <span class="string">"node-ip"</span> /var/lib/kubelet/kubeadm-flags.env | wc -l`</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;COND_NODE_IP&#125;</span> = 1 ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"--node-ip had been set, skipped"</span></span><br><span class="line">  <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">sudo sed -i <span class="string">'/^.*/ s/$/ --node-ip=172.28.128.3/'</span> /var/lib/kubelet/kubeadm-flags.env</span><br><span class="line">sudo systemctl restart kubelet</span><br></pre></td></tr></table></figure><center><small>Shell script for changing â€œnode ipâ€ on master</small></center><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/sh</span></span><br><span class="line"></span><br><span class="line">COND_NODE_IP=`sudo grep <span class="string">"node-ip"</span> /var/lib/kubelet/kubeadm-flags.env | wc -l`</span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$&#123;COND_NODE_IP&#125;</span> = 1 ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"--node-ip had been set, skipped"</span></span><br><span class="line">  <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">sudo sed -i <span class="string">'/^.*/ s/$/ --node-ip=172.28.128.4/'</span> /var/lib/kubelet/kubeadm-flags.env</span><br><span class="line">sudo systemctl restart kubelet docker</span><br></pre></td></tr></table></figure><center><small>Shell script for changing â€œnode ipâ€ on worker</small></center><p><img src="https://i.loli.net/2018/11/26/5bfbbfd1a210f.png" alt="Node: master | get nodes"> <center><small>Node: master | get nodes</small></center></p><p>å°è¯•éƒ¨ç½² dashboardï¼Œè¿˜æ˜¯ä¸èƒ½è®¿é—®ï¼ŒæœŸé—´è¿˜å°è¯•äº†å¥½å‡ ç§åŠæ³•ï¼ŒåŒ…æ‹¬ï¼šä¿®æ”¹ <em>flannel</em> çš„ YAML æ–‡ä»¶ï¼›resetï¼Œé‡å»ºè™šæ‹Ÿæœºï¼›åˆ‡æ¢å…¶å®ƒçš„ CNI æ’ä»¶ï¼›ç­‰ç­‰ã€‚æ— å¤´ç»ªä¹‹é™…ï¼Œåœ¨ <em>flannel</em> çš„ <a href="https://github.com/coreos/flannel/blob/master/Documentation/troubleshooting.md#vagrant" target="_blank" rel="noopener">Github Wik</a> çœ‹åˆ°äº†ä¸€ä¸ªå¾ˆå…³é”®çš„ä¿¡æ¯ï¼š</p><blockquote><p>Vagrant typically assigns two interfaces to all VMs. The first, for which all hosts are assigned the IP address 10.0.2.15, is for external traffic that gets NATed.</p><p>This may lead to problems with flannel. By default, flannel selects the first interface on a host. This leads to all hosts thinking they have the same public IP address. To prevent this issue, pass the <code>--iface eth1</code> flag to flannel so that the second interface is chosen.</p></blockquote><p>é»˜è®¤ä½¿ç”¨ç½‘å¡0ï¼Ÿï¼ IP address 10.0.2.15 ï¼Ÿï¼è¿™åº”è¯¥å°±æ˜¯ä¸€ç›´å‡ºé—®é¢˜çš„æ ¹æºäº†ï¼ä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬è¿˜æ˜¯åˆ‡æ¢å› <em>Weave Net</em>ï¼Œ<code>kubeadm reset</code>ï¼ŒæŠŠæ‰€æœ‰çš„ä¸œè¥¿é‡ç½®ï¼Œç»§ç»­è¯•éªŒã€‚</p><p>é‡ç½®å®Œæˆåï¼Œé‡æ–°æŒ‰ç…§ä¹‹å‰çš„æµç¨‹ï¼Œåˆå§‹åŒ–ï¼Œå®‰è£… CNI æ’ä»¶ï¼ˆ<em>Weave Net</em>ï¼‰ã€‚<em>Weave Net</em> è¿˜æ˜¯åœ¨ä¸æ–­å°è¯•è¿æ¥ 10.96.0.1ã€‚ç»“åˆåˆšæ‰çœ‹åˆ°çš„ <em>flannel</em> çš„è¯´æ˜ï¼Œè·Ÿè¸ªè·¯ç”±çœ‹çœ‹è¯·æ±‚å»äº†å“ªé‡Œï¼Œåœ¨å·¥ä½œèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤<code>traceroute 10.96.0.1</code>ï¼Œå¯ä»¥åœ¨ç»“æœçœ‹åˆ°è¯·æ±‚è¢«è·¯ç”±åˆ°å®¿ä¸»æœºçš„ç½‘ç»œäº†â€¦ éš¾æ€ªä¸€ç›´æ— æ³•è¿æ¥ï¼Œå®ƒåœ¨å°è¯•è¿æ¥åˆ°æˆ‘ä»¬å®¿ä¸»æœºçš„å†…ç½‘ ip ä¸º 10.96.0.1 çš„æœºå™¨ã€‚</p><p>çœ‹ä¸‹é¢ğŸ‘‡æˆªå›¾é‡Œè¿˜æœ‰ä¸€ä¸ª ipï¼Œè·¯ç”±ç¬¬ä¸€è·³æ˜¯ ip 10.0.2.2<br><img src="https://i.loli.net/2018/11/27/5bfd0ddf84222.png" alt="Node: worker | traceroute"><center><small>Node: worker | traceroute</small></center></p><p>çµå…‰ä¸€åŠ¨ï¼Œæƒ³èµ·æ¥ä»¥å‰ç¢°åˆ°è¿‡å› ä¸ºè·¯ç”±è®¾ç½®é”™è¯¯å¯¼è‡´çš„ç½‘ç»œé—®é¢˜ï¼Œç‰¹æ„å»å¤ä¹ äº†ä¸€ä¸‹ Linux è·¯ç”±çŸ¥è¯†ã€‚<br>åœ¨å„ä¸ªèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤<code>ip route</code>æŸ¥çœ‹è·¯ç”±è¡¨ï¼Œå¯ä»¥çœ‹åˆ°è™šæ‹Ÿæœºçš„è·¯ç”±è¡¨è®¾ç½®æ˜¯è®©é»˜è®¤çš„è¯·æ±‚å…¨éƒ½é€šè¿‡ 10.0.2.2 ä¹Ÿå°±æ˜¯å®¿ä¸»æœºçš„ NAT ç½‘å¡ä½œå‡ºç½‘ç»œè¯·æ±‚ï¼Œ</p><p>å·¥ä½œèŠ‚ç‚¹éœ€è¦æ­£å¸¸çš„è¿æ¥åˆ°ä¸»èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±å¿…é¡»è®©å®ƒçš„æµé‡èµ° Host Only ç½‘ç»œï¼Œä¹Ÿå°±æ˜¯ç½‘å¡1ï¼Œè€Œä¸æ˜¯é€šè¿‡ç½‘å¡0ä¸Šçš„ 10.0.2.2 å»å°è¯•è¿æ¥åˆ°å®¿ä¸»æœºçš„ç½‘ç»œä¸»æœºã€‚</p><p>æ£€æŸ¥è™šæ‹Ÿæœº Host Only çš„ç½‘å¡çš„è®¾ç½®ï¼Œåœ¨å®¿ä¸»æœº Terminal æ‰§è¡Œ<code>ifconfig</code>æŸ¥çœ‹å¯¹åº”çš„ç½‘å¡çš„ ip åœ°å€ï¼Œè¿™ä¸ª ip å°±æ˜¯æˆ‘ä»¬ç”¨äºè®©ä¸¤å°è™šæ‹Ÿæœºæ­£å¸¸é€šè®¯çš„è·¯ç”± ipã€‚<br><img src="https://i.loli.net/2018/11/28/5bfdfba3f3067.png" alt="Check the Host Only ip for route"> <center><small>Check the Host Only ip for route</small></center></p><p>ä½¿ç”¨ <code>kubeadm reset</code> é‡è®¾æ‰€æœ‰è®¾å®šï¼Œåˆ«å¿˜äº†æ‰§è¡Œä¹‹å‰å†™çš„æ›´æ”¹ node-ip çš„è„šæœ¬ï¼Œæ‰§è¡Œ ip route ç›¸å…³çš„å­å‘½ä»¤æ›´æ–°è·¯ç”±è¡¨ï¼Œè®©å·¥ä½œèŠ‚ç‚¹æ‰€æœ‰çš„æµé‡é€šè¿‡ç½‘å¡1ï¼Œè¿›è€Œæ­£ç¡®åœ°è®©ä¸»èŠ‚ç‚¹ã€å·¥ä½œèŠ‚ç‚¹äº’ç›¸é€šè®¯ã€‚æ‰§è¡Œé¡ºåºå¦‚ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨å„ä¸ªèŠ‚ç‚¹æ‰§è¡Œ</span></span><br><span class="line">ip route <span class="comment">#æŸ¥çœ‹è·¯ç”±è¡¨</span></span><br><span class="line">sudo kubeadm reset</span><br><span class="line"></span><br><span class="line"><span class="comment"># masterèŠ‚ç‚¹</span></span><br><span class="line">sudo kubeadm init --apiserver-advertise-address=172.28.128.3</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">kubectl apply -f <span class="string">"https://cloud.weave.works/k8s/net?k8s-version=<span class="variable">$(kubectl version | base64 | tr -d '\n')</span>"</span></span><br><span class="line">bash change-kubelet-node-ip.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># nodeèŠ‚ç‚¹</span></span><br><span class="line">sudo kubeadm join 172.28.128.3:6443 --token &lt;token&gt; --discovery-token-ca-cert-hash &lt;token&gt; --apiserver-advertise-address=172.28.128.4</span><br><span class="line">bash change-kubelet-node-ip.sh</span><br><span class="line">sudo ip route del default via 10.0.2.2 &amp;&amp; sudo ip route add default via 172.28.128.1</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤éƒ¨ç½² Kubernetes Dashboardï¼Œåœ¨å®¿ä¸»æœºè®¿é—® <a href="http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login" target="_blank" rel="noopener">http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login</a> éªŒè¯éƒ¨ç½²ç»“æœã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml</span><br><span class="line">kubectl proxy --address 0.0.0.0</span><br></pre></td></tr></table></figure></p><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>åˆ›å»º NGINX çš„yamlã€‚<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    svc:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">ClusterIP</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - port:</span> <span class="number">9999</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">  revisionHistoryLimit:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      svc:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        svc:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">        - name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">          image:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">          - containerPort:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">            protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure></p><ul><li>æ‰§è¡Œå‘½ä»¤<code>kubectl apply -f nginx-rs.yaml</code> éƒ¨ç½² nginx</li><li>å¯åŠ¨ Kubernetes proxy <code>kubectl proxy --address 0.0.0.0</code></li><li>æ ¹æ®å®˜æ–¹æ–‡æ¡£<a href="https://kubernetes.io/zh/docs/tasks/access-application-cluster/access-cluster/#%E6%89%8B%E5%8A%A8%E6%9E%84%E5%BB%BA-apiserver-%E4%BB%A3%E7%90%86-url" target="_blank" rel="noopener">ç›¸å…³æè¿°</a>ï¼Œåœ¨å®¿ä¸»æœºè®¿é—®å¦‚ä¸‹é“¾æ¥ <a href="http://localhost:8001/api/v1/namespaces/default/services/nginx/proxy/" target="_blank" rel="noopener">http://localhost:8001/api/v1/namespaces/default/services/nginx/proxy/</a></li><li>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ å°†çœ‹åˆ°å¦‚ä¸‹é¡µé¢</li></ul><p><img src="https://i.loli.net/2019/03/01/5c78cf3876a85.png" alt="nginx via kube-proxy"><center><small>nginx via kube-proxy</small></center></p><h1 id="å¾…ç»­"><a href="#å¾…ç»­" class="headerlink" title="å¾…ç»­"></a>å¾…ç»­</h1><p>å½“åˆæƒ³å†™è¿™ç¯‡æ–‡ç« æ˜¯ä¸ºäº†è®°å½• Kubernetes åœ¨æœ¬åœ°è™šæ‹Ÿç¯å¢ƒä¸‹çš„é›†ç¾¤éƒ¨ç½²æµç¨‹çš„ï¼Œæ²¡æƒ³åˆ°å› ä¸ºå·¥ä½œå˜åŠ¨ã€è¸©å‘ã€æ€ æƒ°ï¼Œä½¿å¾—è¿™ä¸€ç¯‡æ–‡ç« æ‹–äº†è¿™ä¹ˆé•¿çš„æ—¶é—´ï¼Œå› ä¸ºå¯¹åŸç†ä¸ç†Ÿï¼ŒæœŸé—´é‡å¤äº†å¾ˆå¤šæ¬¡æ“ä½œï¼Œä»¥è‡³äºæ•´ä¸ªæµç¨‹è®°å½•ä¸‹æ¥éå¸¸å†—é•¿ï¼Œè€Œä¸”æœŸé—´ä¸­æ–­äº†å¥½å‡ æ¬¡ï¼Œæ‰€ä»¥è¯­å¥å¯èƒ½ä¼šæœ‰ä¸è¿è´¯çš„æƒ…å†µã€‚æ¥ä¸‹æ¥æˆ‘å°†ä¼šé‡æ•´æ•´ä¸ªæµç¨‹å†™ä¸€ç¯‡å§Šå¦¹ç¯‡ TL;DR ç‰ˆï¼Œæ•¬è¯·æœŸå¾…ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul><li><a href="https://github.com/kubernetes/dashboard/issues/916#issuecomment-307761029" target="_blank" rel="noopener">Dashboard running on master</a></li><li><a href="https://godoc.org/k8s.io/kubernetes/cmd/kubeadm/app/apis/kubeadm/v1alpha3#hdr-Kubeadm_init_configuration_types" target="_blank" rel="noopener">kubeadm with command - alpha - InitConfiguration</a></li><li><a href="https://godoc.org/k8s.io/kubernetes/cmd/kubeadm/app/apis/kubeadm/v1alpha3#hdr-Kubeadm_join_configuration_types" target="_blank" rel="noopener">kubeadm with command - alpha - JoinConfiguration</a></li><li><a href="https://github.com/kubernetes/kubernetes/issues/44702#issuecomment-304211078" target="_blank" rel="noopener">node-ip add to kubelet</a></li><li><a href="https://github.com/coreos/flannel/blob/master/Documentation/troubleshooting.md#vagrant" target="_blank" rel="noopener">troubleshooting - vagrant</a></li><li><a href="https://github.com/coreos/flannel/blob/master/Documentation/troubleshooting.md#vagrant" target="_blank" rel="noopener">vagrant network interface</a></li><li><a href="https://www.vagrantup.com/docs/networking/public_network.html" target="_blank" rel="noopener">vagrant network settings</a></li><li><a href="https://segmentfault.com/a/1190000000638244" target="_blank" rel="noopener">ip route usage - 1</a></li><li><a href="https://www.cnblogs.com/EasonJim/p/8424731.html" target="_blank" rel="noopener">ip route usage - 2</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;!-- Description to show on index here  --&gt;
&lt;p&gt;åœ¨å‰ä¸€é˜µå­å‚åŠ äº†DevOpså›½é™…å³°ä¼š(DevOps International Summit)ï¼Œã€ŠDevOps Handbookã€‹å’Œã€ŠBeyond The Phoenix Projectã€‹çš„è”åˆä½œè€… John Willis åœ¨ä»–çš„åˆ†äº«ä¸­æå‡ºäº†â€œKuberneteså°†æˆä¸ºæœªæ¥çš„ä¸»æµâ€ï¼Œå†åŠ ä¸Šæˆ‘æ‰€åœ¨å…¬å¸æœ‰å¤§é‡çš„å¾®æœåŠ¡æ¶æ„é¡¹ç›®ä½¿ç”¨åˆ°äº†Kubernetesï¼Œé‚å¼€å§‹å­¦ä¹ Kubernetesã€‚&lt;br&gt;é‚£è¦å»å­¦ä¹ å®ƒå°±å¿…é¡»å¾—æœ‰å¯æ“ä½œç¯å¢ƒï¼Œåœ¨&lt;a href=&quot;https://kubernetes.io/docs/setup/pick-right-solution/#local-machine-solutions&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Kuberneteså®˜ç½‘&lt;/a&gt;æä¾›äº†å¥½å¤šä¸ªè§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘é€‰æ‹©äº†éš¾åº¦ç¨é«˜çš„ kubeadm é…åˆç”± Vagrant ä»¥åŠ Virtualbox æ­å»ºçš„è™šæ‹Ÿæœºåˆ›å»º Kubernetes çš„é›†ç¾¤ï¼Œé€šè¿‡ä½¿ç”¨ kubeadm ç†Ÿæ‚‰ Kubernetes çš„éƒ¨ç½²æµç¨‹ä»¥åŠå®ƒçš„åŸç†ã€‚&lt;/p&gt;
&lt;h1 id=&quot;ç›®æ ‡&quot;&gt;&lt;a href=&quot;#ç›®æ ‡&quot; class=&quot;headerlink&quot; title=&quot;ç›®æ ‡&quot;&gt;&lt;/a&gt;ç›®æ ‡&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;å¯åŠ¨ä¸¤ä¸ªè™šæ‹Ÿæœºï¼Œä¸€ä¸ªä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œä¸€ä¸ªä½œä¸ºå·¥ä½œèŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;ç†Ÿæ‚‰ Kubeadm&lt;/li&gt;
&lt;li&gt;åœ¨é›†ç¾¤ä¸Šéƒ¨ç½²Kubernetes-dashboardã€nginx
    
    </summary>
    
      <category term="Solutions" scheme="https://blog.stark-x.cn/categories/Solutions/"/>
    
    
      <category term="Ops" scheme="https://blog.stark-x.cn/tags/Ops/"/>
    
      <category term="Kubernetes" scheme="https://blog.stark-x.cn/tags/Kubernetes/"/>
    
      <category term="Vagrant" scheme="https://blog.stark-x.cn/tags/Vagrant/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä¸Šå¤ç¥å™¨ã€Vim</title>
    <link href="https://blog.stark-x.cn/2018/08/31/the-great-vim/"/>
    <id>https://blog.stark-x.cn/2018/08/31/the-great-vim/</id>
    <published>2018-08-31T12:00:00.000Z</published>
    <updated>2018-08-31T14:41:15.919Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><!-- Description to show on index here  --><blockquote><p><strong>Vim - the ubiquitous text editor</strong><br>Vim is a highly configurable text editor for efficiently creating and changing any kind of text. It is included as â€œviâ€ with most UNIX systems and with Apple OS X.<br>Vim æ˜¯ä¸€ä¸ªå¯ç”¨äºé«˜æ•ˆç‡åˆ›å»ºæˆ–è€…ç¼–è¾‘ä»»æ„ç±»å‹æ–‡æœ¬çš„é«˜åº¦å®šåˆ¶åŒ–çš„æ–‡æœ¬ç¼–è¾‘ã€‚å®ƒä»¥â€viâ€å‘½ä»¤å­˜åœ¨äºåœ¨å¤§å¤šæ•°çš„UNIX æ“ä½œç³»ç»Ÿä»¥åŠApple OS X ä¸­ã€‚</p><p align="right">â€” <a href="https://www.vim.org/" target="_blank" rel="noopener">https://www.vim.org/</a></p></blockquote><p>Vim ä½œä¸ºä¸€ä¸ªâ€œä¸Šå¤â€ç¼–è¾‘å™¨ï¼Œå®ƒæä¾›äº†å¾ˆå¤šå¾ˆç¥å¥‡é«˜æ•ˆçš„ç‰¹æ€§ï¼Œä»¥è‡³äºåœ¨ç°ä»£ç¼–è¾‘å™¨/å¼ºå¤§çš„IDEçš„é€‰æ‹©ä¹‹ä¸­æœ‰ä¸€å¸­ä¹‹åœ°ã€‚<br>Vimæœ‰ä¸€ä¸ªå¾ˆåˆæˆ‘å¿ƒæ„çš„ç‰¹æ€§ï¼Œåœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™ï¼Œå®Œå…¨ä¸éœ€è¦ä½¿ç”¨é¼ æ ‡ï¼Œçœ¼ç›çœ‹åˆ°å“ªå°±å¯ä»¥ç¼–è¾‘å“ªï¼Œç°åœ¨èƒ½æ”¯æŒVimç‰¹æ€§çš„åœ°æ–¹æˆ‘éƒ½å®‰è£…ä¸Šäº†å¯¹åº”çš„æ’ä»¶ï¼Œä¾‹å¦‚Chromeçš„æ’ä»¶ï¼šVimium, Ideaçš„æ’ä»¶ï¼šIdeavimã€‚<br><a id="more"></a></p><h2 id="å…¥é—¨æ•™ç¨‹"><a href="#å…¥é—¨æ•™ç¨‹" class="headerlink" title="å…¥é—¨æ•™ç¨‹"></a>å…¥é—¨æ•™ç¨‹</h2><p>ç½‘ä¸Šæœ‰å¤§é‡çš„å…¥é—¨æ•™ç¨‹ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œé€‰æ‹©ï¼Œåœ¨æ­¤æ¨èå…¶ä¸­å‡ ä¸ªå­¦ä¹ VIMçš„æ•™ç¨‹ã€‚</p><ul><li>Vimè‡ªå¸¦çš„äº’åŠ¨æ•™ç¨‹ï¼Œå®‰è£…å¥½Vimä¹‹åï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œ<code>vimtutor zh_CN</code>è¿›å…¥åˆ°äº’åŠ¨æ•™ç¨‹ä¸­</li><li><a href="https://vim-adventures.com/" target="_blank" rel="noopener">vim-adverntures</a> çº¿ä¸Šæ¸¸æˆçš„æ–¹å¼å­¦ä¹ Vim</li><li><a href="https://www.openvim.com/tutorial.html" target="_blank" rel="noopener">openvim-tutorial</a> ç½‘é¡µäº’åŠ¨æ•™ç¨‹</li></ul><p><small>* <em>Vimçš„å­¦ä¹ æ›²çº¿éå¸¸é™¡å³­ï¼Œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°å¤´æ™•ã€å¿ƒæ‚¸ã€æƒ³ç ¸é”®ç›˜ç­‰æƒ…å†µã€‚</em></small></p><h2 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h2><p>æ¨èé˜…è¯»<a href="https://book.douban.com/subject/25869486/" target="_blank" rel="noopener">ã€ŠVimå®ç”¨æŠ€å·§ã€‹(Practical Vim)</a><br><img src="https://images-na.ssl-images-amazon.com/images/I/614qewK71jL.jpg" alt="Vimå®ç”¨æŠ€å·§" width="50%"></p><blockquote><p>Iâ€™ve been using Vim for server maintenance for more than fifteen years now, but Iâ€™ve only recently started using it for software development. I thought I knew Vim, but Practical Vim has massively improved my code-wrangling productivity.</p><p align="right">â€” Graeme Mathieson (Software Engineer, Rubaidh Ltd.)</p></blockquote><h2 id="As-IDE"><a href="#As-IDE" class="headerlink" title="As IDE"></a>As IDE</h2><p>åœ¨å­¦ä¹ äº†ä»¥ä¸Šçš„å†…å®¹ï¼Œç›¸ä¿¡è¯»è€…å·²ç»å¯ä»¥ä½¿ç”¨Vimè¿›è¡Œå¤§éƒ¨åˆ†çš„æ–‡æœ¬ç¼–è¾‘å·¥ä½œäº†ï¼Œä½†æ˜¯æŠŠå®ƒä½œä¸ºå†™ä»£ç çš„å·¥å…·ï¼Œåœ¨æ²¡æœ‰ç»è¿‡ä»»ä½•é…ç½®çš„æƒ…å†µä¸‹ï¼Œä¼šè®©äººè§‰å¾—ç¼ºäº†ç‚¹ä»€ä¹ˆï¼Œæ²¡æ³•ä½œä¸ºä¸»è¦ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªæ—¶å€™Vimçš„ä¸€å¤§ç‰¹æ€§ â€” æ’ä»¶ï¼Œå¯ä»¥å‘æŒ¥å®ƒçš„ä½œç”¨äº†ã€‚é…åˆé€‚å½“çš„æ’ä»¶ï¼ŒVimå¯ä»¥æ‹¥æœ‰æ–‡ä»¶æ ‘ã€è‡ªåŠ¨è¡¥å…¨ç­‰IDEæä¾›çš„ç‰¹æ€§ã€‚<br>å½“ç„¶ï¼Œåœ¨è¿›è¡Œ<strong>å¤§é¡¹ç›®</strong>çš„å¼€å‘ã€é‡æ„çš„æ—¶å€™ï¼Œæˆ‘è¿˜æ˜¯æ¨èä½¿ç”¨IDEé…åˆVimæ’ä»¶ã€‚</p><h3 id="vimrc-ä½ç½®"><a href="#vimrc-ä½ç½®" class="headerlink" title="vimrc ä½ç½®"></a>vimrc ä½ç½®</h3><p>åœ¨Vimé‡Œæ‰§è¡Œ<code>:help vimrc</code>ï¼Œå¸®åŠ©æ–‡æ¡£é‡Œæœ‰åˆ—å‡ºvimrcçš„ä½ç½®ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Places for your personal initializations:</span><br><span class="line">        Unix$HOME/.vimrc or $HOME/.vim/vimrc</span><br><span class="line">        OS/2$HOME/.vimrc, $HOME/vimfiles/vimrc</span><br><span class="line">                        or $VIM/.vimrc (or _vimrc)</span><br><span class="line">        MS-Windows$HOME/_vimrc, $HOME/vimfiles/vimrc</span><br><span class="line">                        or $VIM/_vimrc</span><br><span class="line">        Amigas:.vimrc, home:.vimrc, home:vimfiles:vimrc</span><br><span class="line">                        or $VIM/.vimrc</span><br></pre></td></tr></table></figure></p><h3 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h3><p>ä»¥ä¸‹åˆ—è¡¨æ˜¯æˆ‘ä½¿ç”¨çš„æ’ä»¶ï¼Œæˆ‘ä½¿ç”¨äº†<a href="https://github.com/junegunn/vim-plug" target="_blank" rel="noopener"><code>Plug</code></a>ç®¡ç†è¿™äº›æ’ä»¶ï¼Œæ›¾ç»æˆ‘ä½¿ç”¨çš„æ˜¯<a href="https://github.com/VundleVim/Vundle.vim" target="_blank" rel="noopener"><code>Vundle</code></a>ï¼Œåæ¥å‘ç°Plugæœ‰æ›´å¼ºå¤§çš„ç‰¹æ€§ï¼Œå°±åˆ‡æ¢è¿‡å»äº†ã€‚ç›¸å¯¹äº<code>Vundle</code>ï¼Œ<code>Plug</code>è¿˜æ”¯æŒå¼‚æ­¥åŠ è½½ã€å¼‚æ­¥æ›´æ–°ã€è‡ªå®šä¹‰è§¦å‘å®‰è£…å‡½æ•°ç­‰ç‰¹æ€§ï¼Œå¤§å¤§å¢åŠ äº†ç®¡ç†æ’ä»¶çš„æ•ˆç‡ã€ä¾¿æ·æ€§ï¼Œæœ€é‡è¦çš„æ˜¯<code>Vundle</code>å·²ç»æœ‰å·®ä¸å¤š4å¹´æ²¡æœ‰æ–°çš„Releaseäº†ã€‚</p><ul><li><a href="https://github.com/tpope/vim-fugitive" target="_blank" rel="noopener">tpope/vim-fugitive</a>: Vimé‡Œä½¿ç”¨Git</li><li><a href="https://github.com/Valloric/YouCompleteMe" target="_blank" rel="noopener"><strong>Valloric/YouCompleteMe</strong></a>: å¿…è£…ï¼Œä»£ç è¡¥å…¨ï¼Œä»£ç æç¤º</li><li><a href="https://github.com/Yggdroot/indentLine" target="_blank" rel="noopener">Yggdroot/indentLine</a>: ç¼©è¿›å‚è€ƒçº¿</li><li><a href="https://github.com/scrooloose/nerdtree" target="_blank" rel="noopener">scrooloose/nerdtree</a>: æ–‡ä»¶ç›®å½•æ ‘</li><li><a href="https://github.com/Xuyuanp/nerdtree-git-plugin" target="_blank" rel="noopener">Xuyuanp/nerdtree-git-plugin</a>: åœ¨ç›®å½•æ ‘ä¸­æ ‡è¯†Gitçš„ä»“åº“å˜æ›´</li><li><a href="https://github.com/scrooloose/nerdcommenter" target="_blank" rel="noopener"><strong>scrooloose/nerdcommenter</strong></a>: å¿…è£…ï¼Œå¿«æ·æ³¨é‡Š</li><li><a href="https://github.com/plasticboy/vim-markdown" target="_blank" rel="noopener">plasticboy/vim-markdown</a>: æ”¯æŒMarkdownè¯­æ³•é«˜äº®</li><li><a href="https://github.com/iamcco/markdown-preview.vim" target="_blank" rel="noopener">iamcco/markdown-preview.vim</a>: Markdowné¢„è§ˆ</li><li><a href="https://github.com/vim-airline/vim-airline" target="_blank" rel="noopener">vim-airline/vim-airline</a>: ä¼˜åŒ–çš„çŠ¶æ€æ </li><li><a href="https://github.com/vim-airline/vim-airline-themes" target="_blank" rel="noopener">vim-airline/vim-airline-themes</a>: çŠ¶æ€æ ä¸»é¢˜</li><li><a href="https://github.com/SirVer/ultisnips" target="_blank" rel="noopener">SirVer/ultisnips</a>: ä»£ç å—æ”¯æŒï¼Œç±»ä¼¼Ideaç³»åˆ—çš„Live-Template</li><li><a href="https://github.com/honza/vim-snippets" target="_blank" rel="noopener">honza/vim-snippets</a>: é»˜è®¤ä»£ç å—ï¼Œä¸â€ultisnipsâ€é…åˆ</li><li><a href="https://github.com/terryma/vim-multiple-cursors" target="_blank" rel="noopener">terryma/vim-multiple-cursors</a>: æ”¯æŒå¤šå¤„åŒæ—¶ä¿®æ”¹</li><li><a href="https://github.com/altercation/vim-colors-solarized" target="_blank" rel="noopener">altercation/vim-colors-solarized</a>: solarizedä¸»é¢˜</li><li><a href="https://github.com/morhetz/gruvbox" target="_blank" rel="noopener">morhetz/gruvbox</a>: gruvboxä¸»é¢˜</li><li><a href="https://github.com/mattn/emmet-vim" target="_blank" rel="noopener"><strong>mattn/emmet-vim</strong></a>: å‰ç«¯ç¨‹åºå‘˜å¿…è£…ï¼Œå¿«é€Ÿç¼–å†™æ ‡ç­¾</li><li><a href="https://github.com/tpope/vim-surround" target="_blank" rel="noopener">tpope/vim-surround</a>: å¿«é€ŸåŒ…æ‹¬æ‹¬å·</li><li><a href="https://github.com/tpope/vim-repeat" target="_blank" rel="noopener">tpope/vim-repeat</a>: è®©<code>.</code>æ­£ç¡®é‡å¤éƒ¨åˆ†æ’ä»¶çš„åŠ¨ä½œ</li><li><a href="https://github.com/leafgarland/typescript-vim" target="_blank" rel="noopener">leafgarland/typescript-vim</a>: æ”¯æŒTypescript</li><li><a href="https://github.com/w0rp/ale" target="_blank" rel="noopener">w0rp/ale</a>: å¼‚æ­¥Lintå¼•æ“</li><li><a href="https://github.com/posva/vim-vue" target="_blank" rel="noopener">posva/vim-vue</a>: æ”¯æŒVue</li><li><a href="https://github.com/jiangmiao/auto-pairs" target="_blank" rel="noopener">jiangmiao/auto-pairs</a>: è‡ªåŠ¨è¡¥å…¨æ‹¬å·ï¼Œå¿«é€ŸåŒ…æ‹¬æ‹¬å·</li><li><a href="https://github.com/junegunn/vim-easy-align" target="_blank" rel="noopener">junegunn/vim-easy-align</a>: å¿«é€Ÿå¯¹é½</li><li><a href="https://github.com/easymotion/vim-easymotion" target="_blank" rel="noopener">easymotion/vim-easymotion</a>: å¿«é€Ÿç§»åŠ¨å½“å‰å…‰æ ‡</li><li><a href="https://github.com/python-mode/python-mode" target="_blank" rel="noopener">python-mode/python-mode</a>: å¢å¼ºå¯¹Pythonçš„æ”¯æŒ</li><li><a href="https://github.com/vim-scripts/groovyindent-unix" target="_blank" rel="noopener">vim-scripts/groovyindent-unix</a>: æ­£ç¡®çš„Groovyç¼©è¿›</li><li><a href="https://github.com/Chiel92/vim-autoformat" target="_blank" rel="noopener">Chiel92/vim-autoformat</a>: æ­£ç¡®çš„æ ¼å¼åŒ–ä»£ç </li><li><a href="https://github.com/arecarn/vim-fold-cycle" target="_blank" rel="noopener">arecarn/vim-fold-cycle</a>: å¿«é€Ÿå±•å¼€å…³é—­æŠ˜å </li><li><a href="https://github.com/pseewald/vim-anyfold" target="_blank" rel="noopener">pseewald/vim-anyfold</a>: ä¼˜åŒ–ç¼©è¿›</li><li><a href="https://github.com/xolox/vim-easytags" target="_blank" rel="noopener">xolox/vim-easytags</a>: è‡ªåŠ¨ç”Ÿæˆtagï¼ˆç”¨äºåˆ—å‡ºå‡½æ•°/æ–¹æ³•ï¼‰</li><li><a href="https://github.com/vim-scripts/taglist.vim" target="_blank" rel="noopener">vim-scripts/taglist.vim</a>: å®˜æ–¹tagæ”¯æŒ</li><li><a href="https://github.com/xolox/vim-misc" target="_blank" rel="noopener">xolox/vim-misc</a>: xoloxçš„æ’ä»¶çš„æ”¯æŒ</li><li><a href="https://github.com/chemzqm/wxapp.vim" target="_blank" rel="noopener">chemzqm/wxapp.vim</a>: æ”¯æŒå¾®ä¿¡å°ç¨‹åºå¼€å‘</li><li><a href="https://github.com/sheerun/vim-polyglot" target="_blank" rel="noopener">sheerun/vim-polyglot</a>: è¯­æ³•æ”¯æŒå¢å¼º</li><li><a href="https://github.com/mileszs/ack.vim" target="_blank" rel="noopener">mileszs/ack.vim</a>: æ–‡ä»¶å†…å®¹å¿«é€Ÿæœç´¢ï¼ˆå½“å‰å·¥ä½œç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼‰</li><li><a href="https://github.com/junegunn/fzf" target="_blank" rel="noopener">junegunn/fzf</a>: æ¨¡ç³Šæœç´¢çš„ä¾èµ–</li><li><a href="https://github.com/junegunn/fzf.vim" target="_blank" rel="noopener">junegunn/fzf.vim</a>: æ–‡ä»¶åã€ç›®å½•æ¨¡ç³Šæœç´¢ï¼ˆå½“å‰å·¥ä½œç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼‰</li></ul><h2 id="å‚è€ƒé…ç½®"><a href="#å‚è€ƒé…ç½®" class="headerlink" title="å‚è€ƒé…ç½®"></a>å‚è€ƒé…ç½®</h2><p>Github: <a href="https://github.com/Stark-X/dotfiles/blob/master/vim/.vimrc" target="_blank" rel="noopener">https://github.com/Stark-X/dotfiles/blob/master/vim/.vimrc</a><br>è¿™æ˜¯æˆ‘çš„vimrcï¼Œè¯»è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¹ æƒ¯ä½œå‡ºç›¸åº”è°ƒæ•´ï¼Œæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºæå‡ºå»ºè®®ã€ç–‘é—®ã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">" Remove python3(3.7) importlib deprecated warning</span></span><br><span class="line"><span class="string">" It had been fixed from "</span>patch-<span class="number">8.1</span>.<span class="number">201</span><span class="comment">"</span></span><br><span class="line"><span class="comment">" https://github.com/vim/vim/issues/3117</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">'python3'</span>) &amp;&amp; !has(<span class="string">'patch-8.1.201'</span>)</span><br><span class="line">  silent! <span class="keyword">python3</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="string">"set nocompatible              "</span> <span class="keyword">be</span> iMproved, required</span><br><span class="line"><span class="keyword">filetype</span> off                  <span class="comment">" required</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" Initialize for the vim-plug</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">'win32'</span>)</span><br><span class="line">    <span class="comment">" set rtp+=$USERPROFILE/vimfiles/bundle/Vundle.vim/</span></span><br><span class="line">    <span class="keyword">call</span> plug#begin(<span class="string">'$USERPROFILE/vimfiles/bundle/'</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment">" set rtp+=~/.vim/bundle/Vundle.vim/</span></span><br><span class="line">    <span class="keyword">call</span> plug#begin(<span class="string">'~/.vim/bundle/'</span>)</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line">Plug <span class="string">'tpope/vim-fugitive'</span></span><br><span class="line">Plug <span class="string">'vim-scripts/L9'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" Post-update hooks to compile the YCM</span></span><br><span class="line"><span class="comment">" ==================== YouCompleteMe ====================</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">BuildYCM</span><span class="params">(info)</span></span></span><br><span class="line">  <span class="comment">" info is a dictionary with 3 fields</span></span><br><span class="line">  <span class="comment">" - name:   name of the plugin</span></span><br><span class="line">  <span class="comment">" - status: 'installed', 'updated', or 'unchanged'</span></span><br><span class="line">  <span class="comment">" - force:  set on PlugInstall! or PlugUpdate!</span></span><br><span class="line">  <span class="keyword">if</span> <span class="variable">a:info</span>.status == <span class="string">'installed'</span> || <span class="variable">a:info</span>.force</span><br><span class="line">    !./install.<span class="keyword">py</span> --<span class="keyword">go</span>-completer --js-completer --java-completer --clang-completer</span><br><span class="line">  <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line">Plug <span class="string">'Valloric/YouCompleteMe'</span>, &#123; <span class="string">'do'</span>: <span class="function"><span class="keyword">function</span><span class="params">('BuildYCM')</span> &#125;</span></span><br><span class="line"><span class="comment">" ==================== YouCompleteMe ====================</span></span><br><span class="line"></span><br><span class="line">Plug <span class="string">'Yggdroot/indentLine'</span></span><br><span class="line">Plug <span class="string">'scrooloose/nerdtree'</span>, &#123; <span class="string">'on'</span>: <span class="string">'NERDTreeToggle'</span> &#125;</span><br><span class="line">Plug <span class="string">'Xuyuanp/nerdtree-git-plugin'</span></span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;f3&gt;</span> :NERDTreeToggle<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="comment">" Ignore *.pyc</span></span><br><span class="line"><span class="keyword">let</span> NERDTreeIgnore = [<span class="string">'\.pyc$'</span>]</span><br><span class="line">autocmd! User nerdtree <span class="keyword">echom</span> <span class="string">'NERDTree is now loaded.'</span></span><br><span class="line"></span><br><span class="line">Plug <span class="string">'scrooloose/nerdcommenter'</span></span><br><span class="line"><span class="comment">" markdown syntax highlight</span></span><br><span class="line">Plug <span class="string">'plasticboy/vim-markdown'</span></span><br><span class="line">Plug <span class="string">'iamcco/markdown-preview.vim'</span>, &#123; <span class="string">'for'</span>: <span class="string">'markdown'</span> &#125;</span><br><span class="line">autocmd! User markdown-preview.<span class="keyword">vim</span> <span class="keyword">echom</span> <span class="string">'MarkdownPreview is now loaded.'</span></span><br><span class="line"></span><br><span class="line">Plug <span class="string">'vim-airline/vim-airline'</span></span><br><span class="line">Plug <span class="string">'vim-airline/vim-airline-themes'</span></span><br><span class="line"><span class="comment">" ==================== Snippets ====================</span></span><br><span class="line">Plug <span class="string">'SirVer/ultisnips'</span></span><br><span class="line">Plug <span class="string">'honza/vim-snippets'</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:UltiSnipsExpandTrigger</span>=<span class="string">"&lt;tab&gt;&lt;tab&gt;"</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:UltiSnipsJumpForwardTrigger</span>=<span class="string">"&lt;c-b&gt;"</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:UltiSnipsJumpBackwardTrigger</span>=<span class="string">"&lt;c-z&gt;"</span></span><br><span class="line"><span class="comment">" ==================== Snippets ====================</span></span><br><span class="line"></span><br><span class="line">Plug <span class="string">'terryma/vim-multiple-cursors'</span></span><br><span class="line">Plug <span class="string">'altercation/vim-colors-solarized'</span></span><br><span class="line">Plug <span class="string">'morhetz/gruvbox'</span></span><br><span class="line">Plug <span class="string">'mattn/emmet-vim'</span></span><br><span class="line">Plug <span class="string">'tpope/vim-surround'</span></span><br><span class="line">Plug <span class="string">'tpope/vim-repeat'</span></span><br><span class="line">Plug <span class="string">'leafgarland/typescript-vim'</span></span><br><span class="line"><span class="comment">" Plug 'ctrlpvim/ctrlp.vim'</span></span><br><span class="line"><span class="comment">" Asynchronous Lint Engine</span></span><br><span class="line">Plug <span class="string">'w0rp/ale'</span></span><br><span class="line">Plug <span class="string">'posva/vim-vue'</span></span><br><span class="line">Plug <span class="string">'jiangmiao/auto-pairs'</span></span><br><span class="line">Plug <span class="string">'junegunn/vim-easy-align'</span></span><br><span class="line">Plug <span class="string">'easymotion/vim-easymotion'</span></span><br><span class="line"><span class="comment">" Themes</span></span><br><span class="line">Plug <span class="string">'sjl/badwolf'</span></span><br><span class="line"><span class="comment">" Optimization for Python</span></span><br><span class="line">Plug <span class="string">'python-mode/python-mode'</span>, &#123; <span class="string">'for'</span>: <span class="string">'python'</span> &#125;</span><br><span class="line">autocmd! User <span class="keyword">python</span>-<span class="keyword">mode</span> <span class="keyword">echom</span> <span class="string">'Python-Mode is now loaded.'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" ==================== Auto Format ====================</span></span><br><span class="line">Plug <span class="string">'vim-scripts/groovyindent-unix'</span></span><br><span class="line">Plug <span class="string">'Chiel92/vim-autoformat'</span></span><br><span class="line"><span class="keyword">noremap</span> <span class="symbol">&lt;F4&gt;</span> :Autoformat<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:formatter_yapf_style</span> = <span class="string">'pep8'</span></span><br><span class="line"><span class="comment">" ==================== Auto Format ====================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" ==================== Code Folding ====================</span></span><br><span class="line">Plug <span class="string">'arecarn/vim-fold-cycle'</span></span><br><span class="line">Plug <span class="string">'pseewald/vim-anyfold'</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:fold_cycle_default_mapping</span> = <span class="number">0</span> <span class="comment">"disable default mappings</span></span><br><span class="line"><span class="keyword">nmap</span> &lt;+&gt; <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">fold</span>-cycle-<span class="keyword">open</span>)</span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;-&gt;</span> <span class="symbol">&lt;Plug&gt;</span>(<span class="keyword">fold</span>-cycle-<span class="keyword">close</span>)</span><br><span class="line"><span class="keyword">autocmd</span> Filetype <span class="keyword">python</span> <span class="keyword">let</span> <span class="variable">b:anyfold_activate</span>=<span class="number">1</span></span><br><span class="line"><span class="keyword">set</span> <span class="built_in">foldlevel</span>=<span class="number">0</span></span><br><span class="line"><span class="comment">" ==================== Code Folding ====================</span></span><br><span class="line"><span class="comment">" ==================== Tags Generator ====================</span></span><br><span class="line"><span class="comment">" Use ^] to jump to definiation</span></span><br><span class="line">Plug <span class="string">'xolox/vim-easytags'</span></span><br><span class="line">Plug <span class="string">'xolox/vim-misc'</span></span><br><span class="line"><span class="comment">" ==================== Tags Generator ====================</span></span><br><span class="line"><span class="comment">" ==================== Tag List ====================</span></span><br><span class="line">Plug <span class="string">'vim-scripts/taglist.vim'</span>, &#123; <span class="string">'on'</span>: <span class="string">'TlistToggle'</span> &#125;</span><br><span class="line"><span class="keyword">noremap</span> <span class="symbol">&lt;F2&gt;</span> :TlistToggle<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="comment">" ==================== Tag List ====================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" ==================== WeChat App ====================</span></span><br><span class="line">Plug <span class="string">'chemzqm/wxapp.vim'</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:neomake_wxml_enabled_makers</span> = [<span class="string">'tidy'</span>, <span class="string">'stylelint'</span>]</span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:user_emmet_settings</span> = &#123;</span><br><span class="line">  \ <span class="string">'wxss'</span>: &#123;</span><br><span class="line">  \   <span class="string">'extends'</span>: <span class="string">'css'</span>,</span><br><span class="line">  \ &#125;,</span><br><span class="line">  \ <span class="string">'wxml'</span>: &#123;</span><br><span class="line">  \   <span class="string">'extends'</span>: <span class="string">'html'</span>,</span><br><span class="line">  \   <span class="string">'aliases'</span>: &#123;</span><br><span class="line">  \     <span class="string">'div'</span>: <span class="string">'view'</span>,</span><br><span class="line">  \     <span class="string">'span'</span>: <span class="string">'text'</span>,</span><br><span class="line">  \   &#125;,</span><br><span class="line">  \  <span class="string">'default_attributes'</span>: &#123;</span><br><span class="line">  \     <span class="string">'block'</span>: [&#123;<span class="string">'wx:for-items'</span>: <span class="string">'&#123;&#123;list&#125;&#125;'</span>,<span class="string">'wx:for-item'</span>: <span class="string">'&#123;&#123;item&#125;&#125;'</span>&#125;],</span><br><span class="line">  \     <span class="string">'navigator'</span>: [&#123;<span class="string">'url'</span>: <span class="string">''</span>, <span class="string">'redirect'</span>: <span class="string">'false'</span>&#125;],</span><br><span class="line">  \     <span class="string">'scroll-view'</span>: [&#123;<span class="string">'bindscroll'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'swiper'</span>: [&#123;<span class="string">'autoplay'</span>: <span class="string">'false'</span>, <span class="string">'current'</span>: <span class="string">'0'</span>&#125;],</span><br><span class="line">  \     <span class="string">'icon'</span>: [&#123;<span class="string">'type'</span>: <span class="string">'success'</span>, <span class="string">'size'</span>: <span class="string">'23'</span>&#125;],</span><br><span class="line">  \     <span class="string">'progress'</span>: [&#123;<span class="string">'precent'</span>: <span class="string">'0'</span>&#125;],</span><br><span class="line">  \     <span class="string">'button'</span>: [&#123;<span class="string">'size'</span>: <span class="string">'default'</span>&#125;],</span><br><span class="line">  \     <span class="string">'checkbox-group'</span>: [&#123;<span class="string">'bindchange'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'checkbox'</span>: [&#123;<span class="string">'value'</span>: <span class="string">''</span>, <span class="string">'checked'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'form'</span>: [&#123;<span class="string">'bindsubmit'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'input'</span>: [&#123;<span class="string">'type'</span>: <span class="string">'text'</span>&#125;],</span><br><span class="line">  \     <span class="string">'label'</span>: [&#123;<span class="string">'for'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'picker'</span>: [&#123;<span class="string">'bindchange'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'radio-group'</span>: [&#123;<span class="string">'bindchange'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'radio'</span>: [&#123;<span class="string">'checked'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'switch'</span>: [&#123;<span class="string">'checked'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'slider'</span>: [&#123;<span class="string">'value'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'action-sheet'</span>: [&#123;<span class="string">'bindchange'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'modal'</span>: [&#123;<span class="string">'title'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'loading'</span>: [&#123;<span class="string">'bindchange'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'toast'</span>: [&#123;<span class="string">'duration'</span>: <span class="string">'1500'</span>&#125;],</span><br><span class="line">  \     <span class="string">'audio'</span>: [&#123;<span class="string">'src'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'video'</span>: [&#123;<span class="string">'src'</span>: <span class="string">''</span>&#125;],</span><br><span class="line">  \     <span class="string">'image'</span>: [&#123;<span class="string">'src'</span>: <span class="string">''</span>, <span class="string">'mode'</span>: <span class="string">'scaleToFill'</span>&#125;],</span><br><span class="line">  \   &#125;</span><br><span class="line">  \ &#125;,</span><br><span class="line">  \&#125;</span><br><span class="line"><span class="comment">" ==================== WeChat App ====================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" ==================== Syntax Support  ====================</span></span><br><span class="line"><span class="comment">" Plug 'martinda/Jenkinsfile-vim-syntax'</span></span><br><span class="line">Plug <span class="string">'sheerun/vim-polyglot'</span></span><br><span class="line"><span class="comment">" ==================== Syntax Support  ====================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" ==================== ACK ====================</span></span><br><span class="line"><span class="comment">" Take place the vimgrep</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">Install_ag</span><span class="params">(info)</span></span></span><br><span class="line">    <span class="comment">" info is a dictionary with 3 fields</span></span><br><span class="line">    <span class="comment">" - name:   name of the plugin</span></span><br><span class="line">    <span class="comment">" - status: 'installed', 'updated', or 'unchanged'</span></span><br><span class="line">    <span class="comment">" - force:  set on PlugInstall! or PlugUpdate!</span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable">a:info</span>.status == <span class="string">'installed'</span> || <span class="variable">a:info</span>.force</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">'macunix'</span>)</span><br><span class="line">            !brew install the_silver_searcher </span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'Please access https://github.com/ggreer/the_silver_searcher for the installation'</span></span><br><span class="line">        <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="comment">" Use ag(the_silver_searcher) as the search engine</span></span><br><span class="line">Plug <span class="string">'mileszs/ack.vim'</span>, &#123; <span class="string">'do'</span>: <span class="function"><span class="keyword">function</span><span class="params">('Install_ag')</span> &#125;</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:ackprg</span> = <span class="string">'ag --vimgrep --hidden'</span></span><br><span class="line"><span class="comment">" ==================== ACK ====================</span></span><br><span class="line"></span><br><span class="line">Plug <span class="string">'junegunn/fzf'</span>, &#123; <span class="string">'dir'</span>: <span class="string">'~/.fzf'</span>, <span class="string">'do'</span>: <span class="string">'./install --all'</span> &#125;</span><br><span class="line">Plug <span class="string">'junegunn/fzf.vim'</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;leader&gt;</span><span class="symbol">&lt;tab&gt;</span> <span class="symbol">&lt;plug&gt;</span>(fzf-maps-n)</span><br><span class="line"><span class="keyword">xmap</span> <span class="symbol">&lt;leader&gt;</span><span class="symbol">&lt;tab&gt;</span> <span class="symbol">&lt;plug&gt;</span>(fzf-maps-<span class="keyword">x</span>)</span><br><span class="line"><span class="keyword">omap</span> <span class="symbol">&lt;leader&gt;</span><span class="symbol">&lt;tab&gt;</span> <span class="symbol">&lt;plug&gt;</span>(fzf-maps-<span class="keyword">o</span>)</span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;C-P&gt;</span> :Files<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" All of your Plugs must be added before the following line</span></span><br><span class="line"><span class="keyword">call</span> plug#end()            <span class="comment">" required</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" To ignore plugin indent changes, instead use:</span></span><br><span class="line"><span class="comment">"filetype plugin on</span></span><br><span class="line"><span class="comment">"</span></span><br><span class="line"><span class="comment">"-----------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" Configuration file for vim</span></span><br><span class="line"><span class="keyword">set</span> modelines=<span class="number">0</span><span class="comment">" CVE-2007-2438</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" Normally we use vim-extensions. If you want true vi-compatibility</span></span><br><span class="line"><span class="comment">" remove change the following statements</span></span><br><span class="line"><span class="keyword">set</span> nocompatible<span class="comment">" Use Vim defaults instead of 100% vi compatibility</span></span><br><span class="line"><span class="keyword">set</span> backspace=<span class="number">2</span><span class="comment">" more powerful backspacing</span></span><br><span class="line"></span><br><span class="line"><span class="string">" Don't write backup file if vim is being called by "</span>crontab -<span class="keyword">e</span><span class="comment">"</span></span><br><span class="line"><span class="keyword">au</span> BufWrite /private/tmp/crontab.* <span class="keyword">set</span> nowritebackup</span><br><span class="line"><span class="string">" Don't write backup file if vim is being called by "</span>chpass<span class="comment">"</span></span><br><span class="line"><span class="keyword">au</span> BufWrite /private/etc/<span class="keyword">pw</span>.* <span class="keyword">set</span> nowritebackup</span><br><span class="line"></span><br><span class="line"><span class="comment">" theme</span></span><br><span class="line"><span class="keyword">set</span> background=dark</span><br><span class="line"><span class="comment">" let g:solarized_termcolors=256</span></span><br><span class="line"><span class="comment">" colorscheme solarized</span></span><br><span class="line"><span class="comment">"colorscheme desert</span></span><br><span class="line"><span class="comment">" colorscheme gruvbox </span></span><br><span class="line"><span class="string">" let g:gruvbox_contrast_dark="</span>hard<span class="comment">"</span></span><br><span class="line"><span class="keyword">colorscheme</span> badwolf</span><br><span class="line"><span class="keyword">set</span> guifont=Source_Code_Pro:h13</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> hls</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">nu</span></span><br><span class="line"><span class="keyword">set</span> tabstop=<span class="number">8</span></span><br><span class="line"><span class="keyword">set</span> <span class="built_in">shiftwidth</span>=<span class="number">4</span></span><br><span class="line"><span class="keyword">set</span> softtabstop=<span class="number">8</span></span><br><span class="line"><span class="keyword">set</span> smarttab</span><br><span class="line"><span class="keyword">set</span> smartindent</span><br><span class="line"><span class="keyword">set</span> expandtab</span><br><span class="line"><span class="comment">"çªå‡ºæ˜¾ç¤ºå½“å‰è¡Œ</span></span><br><span class="line"><span class="keyword">set</span> cursorline</span><br><span class="line"><span class="comment">"å¼€å¯çŠ¶æ€æ </span></span><br><span class="line"><span class="keyword">set</span> laststatus=<span class="number">2</span></span><br><span class="line"><span class="comment">"æ˜¾ç¤ºè¾“å…¥çš„å‘½ä»¤</span></span><br><span class="line"><span class="keyword">set</span> showcmd</span><br><span class="line"><span class="comment">"åœ¨çŠ¶æ€æ æ˜¾ç¤ºå½“å‰å…‰æ ‡ä½ç½®</span></span><br><span class="line"><span class="keyword">set</span> ruler</span><br><span class="line"><span class="comment">"å‘½ä»¤æ¨¡å¼ä¸‹æŒ‰tabåˆ—å‡ºè¡¥å…¨çš„å‘½ä»¤</span></span><br><span class="line"><span class="keyword">set</span> wildmenu</span><br><span class="line"></span><br><span class="line"><span class="keyword">vmap</span> <span class="symbol">&lt;C-c&gt;</span> <span class="comment">"+y</span></span><br><span class="line"><span class="keyword">imap</span> jk <span class="symbol">&lt;Esc&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">autocmd</span> FileType <span class="keyword">c</span>,cpp <span class="keyword">setlocal</span> <span class="built_in">cindent</span></span><br><span class="line"><span class="keyword">autocmd</span> FileType feature <span class="keyword">setlocal</span> <span class="built_in">shiftwidth</span>=<span class="number">2</span></span><br><span class="line"><span class="keyword">autocmd</span> FileType <span class="keyword">make</span> <span class="keyword">setlocal</span> noet</span><br><span class="line"><span class="keyword">autocmd</span> FileType groovy <span class="keyword">setlocal</span> <span class="built_in">cindent</span></span><br><span class="line"><span class="keyword">autocmd</span> FileType yaml,<span class="keyword">conf</span>,json,javascript,vue,markdown <span class="keyword">setlocal</span> <span class="built_in">cindent</span> <span class="keyword">sw</span>=<span class="number">2</span></span><br><span class="line"><span class="keyword">autocmd</span> Filetype markdown <span class="keyword">setlocal</span> spell</span><br><span class="line"></span><br><span class="line"><span class="comment">" for typescript-vim</span></span><br><span class="line"><span class="keyword">autocmd</span> QuickFixCmdPost [^<span class="keyword">l</span>]* nested <span class="keyword">cwindow</span></span><br><span class="line"><span class="keyword">autocmd</span> QuickFixCmdPost    <span class="keyword">l</span>* nested <span class="keyword">lwindow</span></span><br><span class="line"><span class="keyword">autocmd</span> FileType typescript :<span class="keyword">setlocal</span> makeprg=tsc <span class="comment">" find the tsconfig.json to compile</span></span><br><span class="line"></span><br><span class="line"><span class="comment">"markdown-setting: YAML</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:vim_markdown_frontmatter</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">"YCM_Settings</span></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;leader&gt;</span>jd :YcmCompleter GoToDefinitionElseDeclaration<span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="comment">" nnoremap &lt;F5&gt; :YcmForceCompileAndDiagnostics&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:syntastic_cpp_compiler</span>=<span class="string">'g++'</span> <span class="comment">"change the compiler to 'g++' to support c++11</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:syntastic_cpp_compiler_options</span>=<span class="string">'-std=c++11 -stdlib=libc++'</span>  <span class="comment">"set the options of g++ to support c++11</span></span><br><span class="line"><span class="comment">" YCM with TypeScript</span></span><br><span class="line"><span class="keyword">if</span> !exists(<span class="string">"g:ycm_semantic_triggers"</span>)</span><br><span class="line">  <span class="keyword">let</span> <span class="variable">g:ycm_semantic_triggers</span> = &#123;&#125;</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:ycm_semantic_triggers</span>[<span class="string">'typescript'</span>] = [<span class="string">'.'</span>]</span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:ycm_autoclose_preview_window_after_completion</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:ycm_server_python_interpreter</span> = <span class="string">'python3'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">"MarkdownPreview-KeyMapping</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;silent&gt;</span> <span class="symbol">&lt;F8&gt;</span> <span class="symbol">&lt;Plug&gt;</span>MarkdownPreview        <span class="comment">" for normal mode</span></span><br><span class="line"><span class="keyword">imap</span> <span class="symbol">&lt;silent&gt;</span> <span class="symbol">&lt;F8&gt;</span> <span class="symbol">&lt;Plug&gt;</span>MarkdownPreview        <span class="comment">" for insert mode</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;silent&gt;</span> <span class="symbol">&lt;F9&gt;</span> <span class="symbol">&lt;Plug&gt;</span>StopMarkdownPreview    <span class="comment">" for normal mode</span></span><br><span class="line"><span class="keyword">imap</span> <span class="symbol">&lt;silent&gt;</span> <span class="symbol">&lt;F9&gt;</span> <span class="symbol">&lt;Plug&gt;</span>StopMarkdownPreview    <span class="comment">" for insert mode</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">'win32'</span>)</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">g:mkdp_path_to_chrome</span> = <span class="string">'C:\Program Files (x86)\Google\Chrome\Application\chrome.exe'</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">'macunix'</span>)</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">g:mkdp_path_to_chrome</span> = <span class="string">"open -a Google\\ Chrome"</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">"gui_macvim"</span>)</span><br><span class="line">    <span class="comment">" Only work on MacVim, the iTerm2 will use ^[</span></span><br><span class="line">    <span class="keyword">set</span> macmeta</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:mkdp_auto_close</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:mkdp_auto_open</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">"copy and paste</span></span><br><span class="line"><span class="keyword">vmap</span> <span class="symbol">&lt;Leader&gt;</span><span class="keyword">y</span> <span class="comment">"+y</span></span><br><span class="line"><span class="keyword">vmap</span> <span class="symbol">&lt;Leader&gt;</span><span class="keyword">p</span> <span class="comment">"+p</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;Leader&gt;</span><span class="keyword">p</span> <span class="comment">"+p</span></span><br><span class="line"><span class="keyword">vmap</span> <span class="symbol">&lt;Leader&gt;</span><span class="keyword">P</span> <span class="comment">"+P</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;Leader&gt;</span><span class="keyword">P</span> <span class="comment">"+P</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" default width and height</span></span><br><span class="line"><span class="comment">" set lines=27 columns=100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" Emmet (C-y ,)</span></span><br><span class="line"><span class="keyword">autocmd</span> FileType html,css,vue EmmetInstall</span><br><span class="line"></span><br><span class="line"><span class="comment">" let the markdown files link normal</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:vim_markdown_conceal</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" vertical split resize</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;c-w&gt;</span>[ :<span class="keyword">vertical</span> <span class="keyword">resize</span> -<span class="number">5</span><span class="symbol">&lt;CR&gt;</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;c-w&gt;</span>] :<span class="keyword">vertical</span> <span class="keyword">resize</span> +<span class="number">5</span><span class="symbol">&lt;CR&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" improve performance</span></span><br><span class="line"><span class="keyword">set</span> lazyredraw</span><br><span class="line"></span><br><span class="line"><span class="comment">" airline realted</span></span><br><span class="line"><span class="string">" let g:airline_theme="</span>wombat<span class="comment">"</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:airline_theme</span>=<span class="string">'badwolf'</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:airline_powerline_fonts</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:airline</span>#extensions#tabline#enabled = <span class="number">1</span></span><br><span class="line"><span class="keyword">set</span> encoding=utf-<span class="number">8</span></span><br><span class="line"><span class="keyword">set</span> rop=<span class="built_in">type</span>:directx,gamm<span class="variable">a:1</span>.<span class="number">0</span>,contras<span class="variable">t:0</span>.<span class="number">5</span>,leve<span class="variable">l:1</span>,geom:<span class="number">1</span>,renmode:<span class="number">4</span>,taamode:<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" makes the % command work better</span></span><br><span class="line">packadd matchit</span><br><span class="line"></span><br><span class="line"><span class="comment">" ALE setting</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:ale_echo_msg_format</span> = <span class="string">'[%linter%] %s [%severity%]'</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;silent&gt;</span> <span class="symbol">&lt;C-k&gt;</span> <span class="symbol">&lt;Plug&gt;</span>(ale_previous_wrap)</span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;silent&gt;</span> <span class="symbol">&lt;C-j&gt;</span> <span class="symbol">&lt;Plug&gt;</span>(ale_next_wrap)</span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:ale_linters</span> = &#123;</span><br><span class="line">\   <span class="string">'javascript'</span>: [<span class="string">'standard'</span>],</span><br><span class="line">\   <span class="string">'typescript'</span>: [<span class="string">'tslint'</span>],</span><br><span class="line">\   <span class="string">'python'</span>: [<span class="string">'autopep8'</span>]</span><br><span class="line">\&#125;</span><br><span class="line"><span class="comment">" Fix files when they are saved.</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:ale_fix_on_save</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">b:ale_fixers</span> = [<span class="string">'prettier'</span>, <span class="string">'eslint'</span>, <span class="string">'autopep8'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">'win32'</span>)</span><br><span class="line">    <span class="keyword">source</span> $VIMRUNTIME/mswin.<span class="keyword">vim</span></span><br><span class="line">    <span class="keyword">behave</span> mswin</span><br><span class="line">    <span class="keyword">set</span> encoding=utf-<span class="number">8</span></span><br><span class="line">    <span class="keyword">set</span> fileencodings=ucs-bom,utf-<span class="number">8</span>,cp936,gb18030,big5,euc-jp,euc-kr,latin1</span><br><span class="line">    <span class="keyword">set</span> fileencoding=utf-<span class="number">8</span> <span class="comment">" æ–°å»ºæ–‡ä»¶ä½¿ç”¨çš„ç¼–ç </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">" è§£å†³èœå•ä¹±ç </span></span><br><span class="line">    <span class="keyword">set</span> langmenu=zh_CN</span><br><span class="line">    <span class="keyword">let</span> $LANG = <span class="string">'zh_CN.UTF-8'</span></span><br><span class="line">    <span class="keyword">source</span> $VIMRUNTIME/delmenu.<span class="keyword">vim</span></span><br><span class="line">    <span class="keyword">source</span> $VIMRUNTIME/<span class="keyword">menu</span>.<span class="keyword">vim</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">" Disable the alt/meta (&lt;M-*&gt;) mapping on the Windows menu.</span></span><br><span class="line">    <span class="keyword">set</span> winaltkeys=<span class="keyword">no</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" EasyAlign</span></span><br><span class="line"><span class="comment">" Start interactive EasyAlign in visual mode (e.g. vipga)</span></span><br><span class="line"><span class="keyword">xmap</span> ga <span class="symbol">&lt;Plug&gt;</span>(EasyAlign)</span><br><span class="line"></span><br><span class="line"><span class="comment">" Start interactive EasyAlign for a motion/text object (e.g. gaip)</span></span><br><span class="line"><span class="keyword">nmap</span> ga <span class="symbol">&lt;Plug&gt;</span>(EasyAlign)</span><br><span class="line"></span><br><span class="line"><span class="comment">" Auto-paris fly mode</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:AutoPairsFlyMode</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" Easy search the select content</span></span><br><span class="line"><span class="keyword">vnoremap</span> // <span class="keyword">y</span>/<span class="symbol">&lt;c-r&gt;</span><span class="comment">"&lt;cr&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" ctrlp ignore</span></span><br><span class="line"><span class="comment">" let g:ctrlp_custom_ignore = '\v[\/](node_modules|target|dist)|(\.(swp|ico|git|svn))$'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" Comment with one Space</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:NERDSpaceDelims</span>=<span class="number">1</span></span><br><span class="line"><span class="comment">" NERDCommenter for vue settings</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:ft</span> = <span class="string">''</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">NERDCommenter_before</span><span class="params">()</span></span></span><br><span class="line">  <span class="keyword">if</span> &amp;ft == <span class="string">'vue'</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">g:ft</span> = <span class="string">'vue'</span></span><br><span class="line">    <span class="keyword">let</span> stack = <span class="built_in">synstack</span>(<span class="built_in">line</span>(<span class="string">'.'</span>), <span class="keyword">col</span>(<span class="string">'.'</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(stack) &gt; <span class="number">0</span></span><br><span class="line">      <span class="keyword">let</span> syn = <span class="built_in">synIDattr</span>((stack)[<span class="number">0</span>], <span class="string">'name'</span>)</span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">len</span>(syn) &gt; <span class="number">0</span></span><br><span class="line">        <span class="keyword">exe</span> <span class="string">'setf '</span> . <span class="keyword">substitute</span>(<span class="built_in">tolower</span>(syn), <span class="string">'^vue_'</span>, <span class="string">''</span>, <span class="string">''</span>)</span><br><span class="line">      <span class="keyword">endif</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">  <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>! <span class="title">NERDCommenter_after</span><span class="params">()</span></span></span><br><span class="line">  <span class="keyword">if</span> <span class="variable">g:ft</span> == <span class="string">'vue'</span></span><br><span class="line">    <span class="keyword">setf</span> vue</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">g:ft</span> = <span class="string">''</span></span><br><span class="line">  <span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:vue_disable_pre_processors</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">" Vim general</span></span><br><span class="line"><span class="keyword">set</span> nofoldenable</span><br><span class="line"></span><br><span class="line"><span class="comment">" ==================== Easy Motion ====================</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:EasyMotion_do_mapping</span> = <span class="number">0</span> <span class="comment">" Disable default mappings</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" Jump to anywhere you want with minimal keystrokes, with just one key binding.</span></span><br><span class="line"><span class="comment">" `s&#123;char&#125;&#123;label&#125;`</span></span><br><span class="line"><span class="comment">" nmap &lt;space&gt; &lt;Plug&gt;(easymotion-overwin-f)</span></span><br><span class="line"><span class="comment">" or</span></span><br><span class="line"><span class="comment">" `s&#123;char&#125;&#123;char&#125;&#123;label&#125;`</span></span><br><span class="line"><span class="comment">" Need one more keystroke, but on average, it may be more comfortable.</span></span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;space&gt;</span>s <span class="symbol">&lt;Plug&gt;</span>(easymotion-overwin-f2)</span><br><span class="line"></span><br><span class="line"><span class="comment">" &lt;space&gt;f&#123;char&#125; to move to &#123;char&#125;</span></span><br><span class="line"><span class="keyword">map</span>  <span class="symbol">&lt;space&gt;</span><span class="keyword">f</span> <span class="symbol">&lt;Plug&gt;</span>(easymotion-<span class="keyword">bd</span>-<span class="keyword">f</span>)</span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;space&gt;</span><span class="keyword">f</span> <span class="symbol">&lt;Plug&gt;</span>(easymotion-overwin-<span class="keyword">f</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">" Move to line</span></span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;space&gt;</span>L <span class="symbol">&lt;Plug&gt;</span>(easymotion-<span class="keyword">bd</span>-jk)</span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;space&gt;</span>L <span class="symbol">&lt;Plug&gt;</span>(easymotion-overwin-<span class="built_in">line</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">" Move to word</span></span><br><span class="line"><span class="keyword">map</span>  <span class="symbol">&lt;space&gt;</span><span class="keyword">w</span> <span class="symbol">&lt;Plug&gt;</span>(easymotion-<span class="keyword">bd</span>-<span class="keyword">w</span>)</span><br><span class="line"><span class="keyword">nmap</span> <span class="symbol">&lt;space&gt;</span><span class="keyword">w</span> <span class="symbol">&lt;Plug&gt;</span>(easymotion-overwin-<span class="keyword">w</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">" Turn on case insensitive feature</span></span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:EasyMotion_smartcase</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">" JK motions: Line motions</span></span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;space&gt;</span><span class="keyword">j</span> <span class="symbol">&lt;Plug&gt;</span>(easymotion-<span class="keyword">j</span>)</span><br><span class="line"><span class="keyword">map</span> <span class="symbol">&lt;space&gt;</span><span class="keyword">k</span> <span class="symbol">&lt;Plug&gt;</span>(easymotion-<span class="keyword">k</span>)</span><br><span class="line"><span class="comment">" ==================== Easy Motion ====================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">"Keep search pattern at the center of the screen."</span></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;silent&gt;</span> n nzz</span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;silent&gt;</span> <span class="keyword">N</span> Nzz</span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;silent&gt;</span> * *zz</span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;silent&gt;</span> # #zz</span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;silent&gt;</span> g* g*zz</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;!-- Description to show on index here  --&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Vim - the ubiquitous text editor&lt;/strong&gt;&lt;br&gt;Vim is a highly configurable text editor for efficiently creating and changing any kind of text. It is included as â€œviâ€ with most UNIX systems and with Apple OS X.&lt;br&gt;Vim æ˜¯ä¸€ä¸ªå¯ç”¨äºé«˜æ•ˆç‡åˆ›å»ºæˆ–è€…ç¼–è¾‘ä»»æ„ç±»å‹æ–‡æœ¬çš„é«˜åº¦å®šåˆ¶åŒ–çš„æ–‡æœ¬ç¼–è¾‘ã€‚å®ƒä»¥â€viâ€å‘½ä»¤å­˜åœ¨äºåœ¨å¤§å¤šæ•°çš„UNIX æ“ä½œç³»ç»Ÿä»¥åŠApple OS X ä¸­ã€‚&lt;/p&gt;
&lt;p align=&quot;right&quot;&gt;â€” &lt;a href=&quot;https://www.vim.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.vim.org/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Vim ä½œä¸ºä¸€ä¸ªâ€œä¸Šå¤â€ç¼–è¾‘å™¨ï¼Œå®ƒæä¾›äº†å¾ˆå¤šå¾ˆç¥å¥‡é«˜æ•ˆçš„ç‰¹æ€§ï¼Œä»¥è‡³äºåœ¨ç°ä»£ç¼–è¾‘å™¨/å¼ºå¤§çš„IDEçš„é€‰æ‹©ä¹‹ä¸­æœ‰ä¸€å¸­ä¹‹åœ°ã€‚&lt;br&gt;Vimæœ‰ä¸€ä¸ªå¾ˆåˆæˆ‘å¿ƒæ„çš„ç‰¹æ€§ï¼Œåœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™ï¼Œå®Œå…¨ä¸éœ€è¦ä½¿ç”¨é¼ æ ‡ï¼Œçœ¼ç›çœ‹åˆ°å“ªå°±å¯ä»¥ç¼–è¾‘å“ªï¼Œç°åœ¨èƒ½æ”¯æŒVimç‰¹æ€§çš„åœ°æ–¹æˆ‘éƒ½å®‰è£…ä¸Šäº†å¯¹åº”çš„æ’ä»¶ï¼Œä¾‹å¦‚Chromeçš„æ’ä»¶ï¼šVimium, Ideaçš„æ’ä»¶ï¼šIdeavimã€‚&lt;br&gt;
    
    </summary>
    
      <category term="Tools" scheme="https://blog.stark-x.cn/categories/Tools/"/>
    
    
      <category term="Vim" scheme="https://blog.stark-x.cn/tags/Vim/"/>
    
      <category term="Coding" scheme="https://blog.stark-x.cn/tags/Coding/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ kolla-ansible éƒ¨ç½² OpenStack</title>
    <link href="https://blog.stark-x.cn/2018/08/01/Use-kolla-ansible-deploy-OpenStack/"/>
    <id>https://blog.stark-x.cn/2018/08/01/Use-kolla-ansible-deploy-OpenStack/</id>
    <published>2018-08-01T02:46:54.000Z</published>
    <updated>2018-08-31T02:42:26.953Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨<code>kolla-ansible</code>éƒ¨ç½²â€all-in-oneâ€ OpenStack Queens<br><!-- toc --><br><!-- Description to show on index here  --></p><h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><p>æ­¤æ•™ç¨‹åœ¨MacOSä¸Šå®Œæˆï¼Œåœ¨å¼€å§‹å‰è¯·é¢„ç•™8Gbå†…å­˜ï¼Œ30Gçš„ç£ç›˜ç©ºé—´ï¼Œå› ä¸ºè¦ä¸‹è½½ç›¸å…³èµ„æºæ–‡ä»¶ï¼Œæœ€å¥½æ­å¥½æ¢¯å­ã€‚</p><h2 id="å®‰è£…ç¯å¢ƒ"><a href="#å®‰è£…ç¯å¢ƒ" class="headerlink" title="å®‰è£…ç¯å¢ƒ"></a>å®‰è£…ç¯å¢ƒ</h2><ul><li><a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="noopener">VirtualBox</a></li><li><a href="https://www.vagrantup.com/" target="_blank" rel="noopener">Vagrant</a></li></ul><p>MacOSä¸Šå¼ºçƒˆæ¨èä½¿ç”¨<a href="https://brew.sh/index_zh-cn" target="_blank" rel="noopener">Homebrew</a>, ç„¶åä½¿ç”¨å‘½ä»¤<code>brew tap caskroom/cask</code>å®‰è£…caskï¼Œå®‰è£…å®Œæ¯•ä¹‹åï¼Œå®‰è£…ä¸Šè¿°ä¸¤ä¸ªApplicationåªéœ€è¦ä½¿ç”¨<code>brew cask install virtualbox vagrant</code>å³å¯å¿«é€Ÿå®Œæˆè§£å‹ã€å®‰è£…ç­‰ä¸€ç³»åˆ—äººæ‰‹æ“ä½œã€‚</p><a id="more"></a><h1 id="ä¸‹è½½Vagrantfileå¹¶å¯åŠ¨"><a href="#ä¸‹è½½Vagrantfileå¹¶å¯åŠ¨" class="headerlink" title="ä¸‹è½½Vagrantfileå¹¶å¯åŠ¨"></a>ä¸‹è½½Vagrantfileå¹¶å¯åŠ¨</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span></span><br><span class="line">mkdir -p workspace/learning/openstack</span><br><span class="line"><span class="built_in">cd</span> workspace/learning/openstack</span><br><span class="line">curl -sS https://gist.github.com/Stark-X/d1e7ce4b8fcd2ea775249978237939f1</span><br><span class="line">time vagrant up</span><br></pre></td></tr></table></figure><p>Vagrantfileä½¿ç”¨äº†CentOS 7 ä½œä¸ºVMçš„imageï¼Œè¿˜åŒ…å«äº†ä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œå¦‚å®‰è£…dockerï¼ŒèŠ±è´¹æ—¶é—´è§†ä¸»æœºæ€§èƒ½ã€ç½‘ç»œè€Œå®šã€‚<br><small>* <em>ä½œä¸ºå‚è€ƒï¼Œç¬”è€…ä½¿ç”¨çš„15ç‰ˆMBP(2.2Ghz i7 cpu, 16Gb mem, macOS High Sierra v10.13.6)ï¼Œå·²æœ‰CentOSé•œåƒç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œç”¨äº†10åˆ†é’Ÿã€‚</em></small></p><h1 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h1><h2 id="globals-yml"><a href="#globals-yml" class="headerlink" title="globals.yml"></a>globals.yml</h2><p>ä½ç½®ï¼š/etc/kolla/globals.yml<br>è¿™ä¸ªæ–‡ä»¶æ˜¯kolla-ansibleéƒ¨ç½²çš„å…³é”®é…ç½®æ–‡ä»¶ï¼Œç½‘ç»œã€ç»„ä»¶å¼€å¯å…³é—­ç­‰æ‰€æœ‰çš„é…ç½®éƒ½ç”±æ­¤æ–‡ä»¶å†³å®šã€‚<br>ä»¥ä¸‹å‡ ä¸ªé…ç½®åªæ˜¯å…¶ä¸­ä¸€éƒ¨åˆ†ï¼ŒOpenStackè¿˜æœ‰æ›´å¤šçš„å‚æ•°å¯ä»¥æ”¹å˜ï¼Œå…·ä½“æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Valid options are ['centos', 'debian', 'oraclelinux', 'rhel', 'ubuntu']</span></span><br><span class="line"><span class="attr">kolla_base_distro:</span> <span class="string">"centos"</span></span><br><span class="line"><span class="comment"># Valid options are [ binary, source ]</span></span><br><span class="line"><span class="attr">kolla_install_type:</span> <span class="string">"source"</span></span><br><span class="line"><span class="comment"># Valid option is Docker repository tag</span></span><br><span class="line"><span class="attr">openstack_release:</span> <span class="string">"queens"</span></span><br><span class="line"><span class="attr">enable_haproxy:</span> <span class="literal">no</span></span><br><span class="line"><span class="attr">network_interface:</span> <span class="string">eth0</span></span><br><span class="line"><span class="attr">network_external_interface:</span> <span class="string">eth1</span></span><br><span class="line"><span class="attr">kolla_internal_vip_address:</span> <span class="number">10.0</span><span class="number">.2</span><span class="number">.15</span></span><br></pre></td></tr></table></figure></p><h1 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h1><h2 id="éƒ¨ç½²å‰æ£€æŸ¥"><a href="#éƒ¨ç½²å‰æ£€æŸ¥" class="headerlink" title="éƒ¨ç½²å‰æ£€æŸ¥"></a>éƒ¨ç½²å‰æ£€æŸ¥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯è°ƒè¯•æ¨¡å¼çš„è¾“å‡ºå›æ˜¾ï¼Œä¾¿äºæŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line"><span class="comment"># ref: https://github.com/ansible/ansible/issues/27078</span></span><br><span class="line"><span class="built_in">export</span> ANSIBLE_STDOUT_CALLBACK=debug</span><br><span class="line">sudo kolla-ansible prechecks -i all-in-one</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ­¥éª¤ä¼šæ£€æŸ¥é…ç½®æ–‡ä»¶è®¾ç½®æ˜¯å¦å¯ç”¨ï¼Œå®é™…ä¸Šæ˜¯åº•å±‚è°ƒç”¨äº†ansible-playbookæ‰§è¡Œäº†ä¸€ç³»åˆ—çš„æ“ä½œã€‚</p><h3 id="å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼š"><a href="#å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼š" class="headerlink" title="å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼š"></a>å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼š</h3><h4 id="Error-Hostname-has-to-resolve-to-IP-address-of-api-interface"><a href="#Error-Hostname-has-to-resolve-to-IP-address-of-api-interface" class="headerlink" title="Error: Hostname has to resolve to IP address of api_interface"></a>Error: Hostname has to resolve to IP address of api_interface</h4><p>æ£€æŸ¥/etc/hostsæ–‡ä»¶é‡Œé¢çš„ä¸»æœºåæ˜¯å¦ä¸º127.0.0.1ï¼Œæ›´æ–°â€kolla_internal_vip_addressâ€åœ¨globals.ymlæ–‡ä»¶é‡Œçš„å€¼ã€‚</p><h4 id="TASK-haproxy-Checking-if-kolla-internal-vip-address-and-kolla-external-vip-address-are-not-pingable-from-any-node-failed"><a href="#TASK-haproxy-Checking-if-kolla-internal-vip-address-and-kolla-external-vip-address-are-not-pingable-from-any-node-failed" class="headerlink" title="TASK [haproxy : Checking if kolla_internal_vip_address and kolla_external_vip_address are not pingable from any node] failed"></a>TASK [haproxy : Checking if kolla_internal_vip_address and kolla_external_vip_address are not pingable from any node] failed</h4><p>å› ä¸ºéƒ¨ç½²ä¸ºâ€all_in_oneâ€ï¼Œä¸éœ€è¦â€HA Proxyâ€ï¼Œç¼–è¾‘globals.ymlï¼Œå»æ‰â€enable_haproxyâ€çš„æ³¨é‡Šï¼Œå¹¶æŠŠå€¼æ”¹ä¸ºâ€noâ€</p><h2 id="éƒ¨ç½²-1"><a href="#éƒ¨ç½²-1" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo kolla-ansible deploy -i all-in-one</span><br></pre></td></tr></table></figure><p>éƒ¨ç½²æ—¶é—´ä¸ç½‘ç»œçŠ¶å†µæŒ‚é’©ï¼Œglobals.ymlä¸­<code>enable_*</code>ä¸ºyesçš„ç»„ä»¶è¶Šå¤šï¼Œæ—¶é—´è¶Šé•¿ï¼Œå¦å¤–ï¼Œç¬¬ä¸€æ¬¡éƒ¨ç½²ä¼šæ‹‰å–éœ€è¦çš„Dockeré•œåƒï¼Œå¯è‡ªè¡Œæ¶è®¾ç§æœ‰é•œåƒä»“åº“ï¼Œæ›´æ”¹dockeré…ç½®ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“ï¼ŒåŠ å¿«éƒ¨ç½²é€Ÿåº¦ã€‚</p><h2 id="ç”Ÿæˆå‘½ä»¤è¡Œæ§åˆ¶æ–‡ä»¶"><a href="#ç”Ÿæˆå‘½ä»¤è¡Œæ§åˆ¶æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆå‘½ä»¤è¡Œæ§åˆ¶æ–‡ä»¶"></a>ç”Ÿæˆå‘½ä»¤è¡Œæ§åˆ¶æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo kolla-ansible post-deploy -i all-in-one</span><br><span class="line"><span class="comment"># åŠ è½½ç¯å¢ƒä¿¡æ¯</span></span><br><span class="line">. /etc/kolla/admin-openrc.sh</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæ¯•åï¼Œ/etc/kolla/admin-openrc.sh ä¼šè¢«ç”Ÿæˆï¼Œä½¿ç”¨<code>cat</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°å…¶ä¸­çš„ç¯å¢ƒä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šè¢«openstack clientç”¨äºæ“ä½œOpenStackã€‚</p><h1 id="Have-fun"><a href="#Have-fun" class="headerlink" title="Have fun"></a>Have fun</h1><h2 id="åˆå§‹åŒ–demoç¯å¢ƒ"><a href="#åˆå§‹åŒ–demoç¯å¢ƒ" class="headerlink" title="åˆå§‹åŒ–demoç¯å¢ƒ"></a>åˆå§‹åŒ–demoç¯å¢ƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè™šæ‹Ÿç½‘ç»œï¼Œåˆ›å»ºflavorï¼Œä¸Šä¼ æ¨¡æ¿ç­‰</span></span><br><span class="line">bash /usr/share/kolla-ansible/init-runonce</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæ¯•åï¼Œæç¤ºç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªdemoå®ä¾‹ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openstack server create \\</span><br><span class="line">    --image *** \\</span><br><span class="line">    --flavor m1.tiny \\</span><br><span class="line">    --key-name mykey \\</span><br><span class="line">    --nic net-id=*** \\</span><br><span class="line">    demo1</span><br></pre></td></tr></table></figure></p><p>åˆ›å»ºå®Œæ¯•åï¼Œæ‰§è¡Œ<code>openstack console url show demo1</code>æŸ¥çœ‹åœ¨çº¿æ§åˆ¶å°çš„URLï¼Œå¯é€šè¿‡noVNCè¿æ¥åˆ°å®ä¾‹çš„shellã€‚<br><small>*<em>åœ¨virtualboxè®¾ç½®natç«¯å£æ˜ å°„</em></small><br>æˆ–è€…åœ¨è™šæ‹Ÿæœºå†…æ‰§è¡Œå‘½ä»¤<code>sudo ip netns exec [NAME] ssh cirros@&lt;ip&gt;</code>åˆ‡æ¢network namespaceï¼Œsshåˆ°ç›®æ ‡å®ä¾‹ã€‚<br>å¦å¤–ï¼Œç±»ä¼¼<code>docker logs &lt;container_name&gt;</code>ï¼Œæˆ‘ä»¬å¯æ‰§è¡Œå‘½ä»¤<code>openstack console log show demo1</code>æŸ¥çœ‹å®ä¾‹çš„æ—¥å¿—ã€‚</p><h2 id="ç™»å½•Admin"><a href="#ç™»å½•Admin" class="headerlink" title="ç™»å½•Admin"></a>ç™»å½•Admin</h2><h3 id="è·å–å¯†ç "><a href="#è·å–å¯†ç " class="headerlink" title="è·å–å¯†ç "></a>è·å–å¯†ç </h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep keystone_admin_password /etc/kolla/passwords.yml</span><br></pre></td></tr></table></figure><h3 id="ç™»å½•Admin-1"><a href="#ç™»å½•Admin-1" class="headerlink" title="ç™»å½•Admin"></a>ç™»å½•Admin</h3><p>Url: <a href="http://localhost:8080/auth/login/" target="_blank" rel="noopener">http://localhost:8080/auth/login/</a><br>User: admin<br>Password: ***<br><small>*<em>åœ¨virtualboxè®¾ç½®natç«¯å£æ˜ å°„</em></small></p><h1 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h1><h2 id="ä¿®æ­£é”™è¯¯çš„é…ç½®"><a href="#ä¿®æ­£é”™è¯¯çš„é…ç½®" class="headerlink" title="ä¿®æ­£é”™è¯¯çš„é…ç½®"></a>ä¿®æ­£é”™è¯¯çš„é…ç½®</h2><p>è‹¥å‘ç°é…ç½®é”™è¯¯ï¼Œéœ€è¦é‡æ–°éƒ¨ç½²ï¼Œå¯é€‰æ‹©ä½¿ç”¨ä»¥ä¸‹å·¥å…·æ¸…ç†ç¯å¢ƒã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bash /usr/share/kolla-ansible/tools/stop-containers</span><br><span class="line">bash /usr/share/kolla-ansible/tools/cleanup-containers</span><br><span class="line">bash /usr/share/kolla-ansible/tools/cleanup-host</span><br><span class="line">bash /usr/share/kolla-ansible/tools/cleanup-images</span><br><span class="line"><span class="comment"># Or</span></span><br><span class="line">sudo  kolla-ansible destroy -i all-in-one --yes-i-really-really-mean-it &amp;&amp; kolla-ansible deploy -i all-in-one</span><br></pre></td></tr></table></figure></p><h2 id="è®¾å®šçš„IPæ— æ³•è®¿é—®"><a href="#è®¾å®šçš„IPæ— æ³•è®¿é—®" class="headerlink" title="è®¾å®šçš„IPæ— æ³•è®¿é—®"></a>è®¾å®šçš„IPæ— æ³•è®¿é—®</h2><p>åŸæœ¬å®¿ä¸»æœºã€è™šæ‹Ÿæœºä¹‹é—´å¯é€šè¿‡192.168.56.101é€šè®¯ï¼Œéƒ¨ç½²å®Œæˆåï¼Œæ— æ³•ç»§ç»­é€šè®¯äº†ï¼Œè¿™æ˜¯å› ä¸ºNeutronæ¥ç®¡äº†ç½‘ç»œï¼Œæ”¾ç½®åˆ°äº†ä¸åŒçš„namespaceï¼Œå¯é€šè¿‡<code>ip netns</code>çœ‹åˆ°ä¸¤ä¸ªæ–°çš„network namespaceï¼Œä½¿ç”¨å‘½ä»¤<code>ip netns exec [NAME] ping &lt;ip&gt;</code>éªŒè¯ã€‚</p><h2 id="OpenStack-Clientç›¸å…³å‘½ä»¤"><a href="#OpenStack-Clientç›¸å…³å‘½ä»¤" class="headerlink" title="OpenStack Clientç›¸å…³å‘½ä»¤"></a>OpenStack Clientç›¸å…³å‘½ä»¤</h2><p>ä»¥ä¸‹åˆ—å‡ºéƒ¨åˆ†OpenStack clientçš„å‘½ä»¤ï¼Œå¯ä½¿ç”¨<code>openstack [command] help</code>æŸ¥çœ‹ç›¸å…³çš„å¸®åŠ©ä¿¡æ¯ã€‚</p><ul><li>openstack flavor list</li><li>openstack server list</li><li>openstack server show [SERVER_NAME]</li><li>â€¦ </li></ul><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul><li>[ä½¿ç”¨Kolla-Ansibleåœ¨CentOS 7å•èŠ‚ç‚¹ä¸Šéƒ¨ç½²OpenStack Pike] <a href="https://blog.csdn.net/yan7895566/article/details/79645774" target="_blank" rel="noopener">https://blog.csdn.net/yan7895566/article/details/79645774</a></li><li>[åˆ©ç”¨kollaå¿«é€Ÿæ­å»ºopenstack-ocataå•èŠ‚ç‚¹] <a href="https://www.lijiawang.org/posts/kolla-openstack-ocata.html" target="_blank" rel="noopener">https://www.lijiawang.org/posts/kolla-openstack-ocata.html</a></li><li>[CentOS7å•èŠ‚ç‚¹éƒ¨ç½²OpenStack-Pike(ä½¿ç”¨kolla-ansible)] <a href="https://blog.csdn.net/persistvonyao/article/details/80229602#5deploy%E6%97%B6%E6%8A%A5%E9%94%99-please-enable-at-least-one-backend-when-enabling-cinder" target="_blank" rel="noopener">https://blog.csdn.net/persistvonyao/article/details/80229602#5deploy%E6%97%B6%E6%8A%A5%E9%94%99-please-enable-at-least-one-backend-when-enabling-cinder</a></li><li>[ä½¿ç”¨kollaå¿«é€Ÿéƒ¨ç½²openstack all-in-oneç¯å¢ƒ] <a href="https://www.sunmite.com/openstack/use-kolla-deploy-openstack-all-in-one.html" target="_blank" rel="noopener">https://www.sunmite.com/openstack/use-kolla-deploy-openstack-all-in-one.html</a></li><li>[kolla-ansible Quick Start] <a href="https://docs.openstack.org/kolla-ansible/latest/user/quickstart.html" target="_blank" rel="noopener">https://docs.openstack.org/kolla-ansible/latest/user/quickstart.html</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä½¿ç”¨&lt;code&gt;kolla-ansible&lt;/code&gt;éƒ¨ç½²â€all-in-oneâ€ OpenStack Queens&lt;br&gt;&lt;!-- toc --&gt;&lt;br&gt;&lt;!-- Description to show on index here  --&gt;&lt;/p&gt;
&lt;h1 id=&quot;å‡†å¤‡&quot;&gt;&lt;a href=&quot;#å‡†å¤‡&quot; class=&quot;headerlink&quot; title=&quot;å‡†å¤‡&quot;&gt;&lt;/a&gt;å‡†å¤‡&lt;/h1&gt;&lt;p&gt;æ­¤æ•™ç¨‹åœ¨MacOSä¸Šå®Œæˆï¼Œåœ¨å¼€å§‹å‰è¯·é¢„ç•™8Gbå†…å­˜ï¼Œ30Gçš„ç£ç›˜ç©ºé—´ï¼Œå› ä¸ºè¦ä¸‹è½½ç›¸å…³èµ„æºæ–‡ä»¶ï¼Œæœ€å¥½æ­å¥½æ¢¯å­ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å®‰è£…ç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#å®‰è£…ç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…ç¯å¢ƒ&quot;&gt;&lt;/a&gt;å®‰è£…ç¯å¢ƒ&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.virtualbox.org/wiki/Downloads&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;VirtualBox&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vagrantup.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Vagrant&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;MacOSä¸Šå¼ºçƒˆæ¨èä½¿ç”¨&lt;a href=&quot;https://brew.sh/index_zh-cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Homebrew&lt;/a&gt;, ç„¶åä½¿ç”¨å‘½ä»¤&lt;code&gt;brew tap caskroom/cask&lt;/code&gt;å®‰è£…caskï¼Œå®‰è£…å®Œæ¯•ä¹‹åï¼Œå®‰è£…ä¸Šè¿°ä¸¤ä¸ªApplicationåªéœ€è¦ä½¿ç”¨&lt;code&gt;brew cask install virtualbox vagrant&lt;/code&gt;å³å¯å¿«é€Ÿå®Œæˆè§£å‹ã€å®‰è£…ç­‰ä¸€ç³»åˆ—äººæ‰‹æ“ä½œã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Solutions" scheme="https://blog.stark-x.cn/categories/Solutions/"/>
    
    
      <category term="Cloud" scheme="https://blog.stark-x.cn/tags/Cloud/"/>
    
      <category term="OpenStack" scheme="https://blog.stark-x.cn/tags/OpenStack/"/>
    
      <category term="Ops" scheme="https://blog.stark-x.cn/tags/Ops/"/>
    
  </entry>
  
</feed>
